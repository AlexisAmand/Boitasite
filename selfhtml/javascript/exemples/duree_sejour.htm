<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>SELFHTML: JavaScript / Exemples d'application / Afficher la dur&eacute;e de visite sur une page Web</title>
<link rel="stylesheet" type="text/css" href="../../src/selfhtml.css">
<meta name="description"    content="Wie Sie mit Hilfe von JavaScript in einem kleinen Feld Minuten und Sekunden anzeigen k&ouml;nnen, die seit dem Aufruf der Seite verstrichen sind.">
<meta name="keywords"       content="SELFHTML, JavaScript, Zeit, time">
<meta name="author"         content="Stefan M&uuml;nz, selfhtml@teamone.de">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<meta name="DC.Publisher"   content="Serge Fran&ccedil;ois, selfhtml@selfhtml.com.fr">
<meta name="DC.Date"        content="2003-01-27T08:00+00:00">
<meta name="DC.Identifier"  content="http://selfhtml.selfhtml.com.fr/javascript/exemples/duree_sejour.htm">
<meta name="DC.Language"    content="fr">
<meta name="DC.Rights"      content="../../editorial/copyright.htm">
<meta name="DC.Date.Create" content="2003-01-27T08:00+00:00">
<meta name="SELF.Version"   content="1">
<meta name="SELF.Pagetype"  content="Information">
<meta name="SELF.Path"      content="SELFHTML == ../../index.htm // JavaScript/DOM == ../index.htm // JavaScript Exemples d'application == index.htm">
<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//matomo.boitasite.com/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#AA5522" vlink="#772200" alink="#000000">

<table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr>
<td bgcolor="#FFEEDD" class="nav"><a class="an" name="top"><img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"></a> <a href="../../index.htm"><b>SELFHTML</b></a>/<a href="../../navigation/index.htm" target="_parent">Aides &agrave; la navigation</a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="../index.htm"><b>JavaScript/DOM</b></a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="index.htm"><b>Exemples d'application</b></a></td>
</tr>
</table><table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr>
<td bgcolor="#EEEEEE" class="doc" width="110"><img src="../../src/logo.gif" width="106" height="109" border="0" alt="SELFHTML"></td>
<td bgcolor="#EEEEEE" class="doc" valign="bottom" width="100%"><h2>Afficher la dur&eacute;e de visite sur une page Web</h2>
<tr>
<td bgcolor="#EEEEEE" class="doc" valign="top" align="center">
<img src="../../src/docx.gif" width="30" height="20" vspace="6" border="0" alt="Page d'information: vue d'ensemble">
</td>
<td bgcolor="#FFFFFF" valign="top" nowrap>
<p>
<img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas">&nbsp;<a href="#remarques"><b>Remarques sur cet exemple</b></a><br>
<img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas">&nbsp;<a href="#texte_source"><b>Texte source avec explications</b></a><br>
</p>
<p><img src="../../src/docf.gif" width="15" height="10" border="0" alt="D&eacute;monstration - nouvelle fen&ecirc;tre">&nbsp;<a href="affichage/duree_sejour.htm" target="_blank"><b>Exemple d'affichage: aper&ccedil;u</b></a></p>
</td>
</tr><tr><td colspan="2" bgcolor="#EEEEEE" class="doc">&#160;<a href="#bottom"><img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas"></a>&#160;</td></tr>
</table>



<h2 class="Sh2"><a class="an" name="remarques">Remarques sur cet exemple</a></h2>

<p>L'exemple de cette page affiche en permanence, dans un petit champ de saisie, combien de minutes et de secondes se sont &eacute;coul&eacute;es depuis l'appel de la page. L'affichage du champ est con&ccedil;u avant tout pour des fichiers HTML devant &ecirc;tre affich&eacute;s en permanence, comme dans une fen&ecirc;tre cadre avec un logo ou avec des liens. Dans de tels cas, le chrono tourne pendant tout le temps que l'utilisateur passe sur les pages. Ceci peut appara&icirc;tre &ecirc;tre un jouet superflu - mais supposez que quelque chose soit affich&eacute; qui int&eacute;resse r&eacute;ellement l'utilisateur au point qu'il en oublie le temps co&ucirc;teux qu'il est en ligne, comme par exemple un jeu ou une fen&ecirc;tre de discussion... Un tel petit &quot;pense-b&ecirc;te&quot; sous forme de chronom&egrave;tre peut s'av&eacute;rer bien utile.</p>




<table bgcolor="#EEEEEE" class="doc" width="100%"><tr><td>
&#160;<a href="#top"><img src="../../src/haut.gif" width="14" height="10" border="0" alt="vers le haut"></a><a href="#bottom"><img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas"></a>&#160;
</td></tr></table>
<h2 class="Sh2"><img src="../../src/netsc2.gif" width="30" height="30" border="0" alt="Netscape 2.0"><img src="../../src/msie3.gif" width="30" height="30" border="0" alt="MS IE 3.0">&nbsp;<a class="an" name="texte_source">Texte source avec explications</a></h2>

<p>L'exemple montre le fichier HTML qui contient le JavaScript et l'affichage de l'heure. Dans l'exemple d'affichage, ce fichier est incorpor&eacute; dans un jeu de cadres.</p>

<h3 class="xmp">Exemple:</h3>

<p><img src="../../src/docf.gif" width="15" height="10" border="0" alt="D&eacute;monstration - nouvelle fen&ecirc;tre">&nbsp;<a href="affichage/duree_sejour.htm" target="_blank"><b>Exemple d'affichage: aper&ccedil;u</b></a></p>

<table width="100%" cellpadding="10"><tr><td class="xmpcode" bgcolor="#FFFFE0"><pre>
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Afficher la dur�e de visite sur une page Web&lt;/title&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
&lt;!--
var maintenant = new Date();
var Start = maintenant.getTime();

function affiche_heure() {
var secondes_abs = Math.round(calcul_temps());
var secondes_rel = secondes_abs % 60;
var minutes_abs = Math.abs(Math.round(secondes_abs-30)/60));

var nombre_secondes =&quot;&quot; + ((secondes_rel &gt; 9) ? secondes_rel : &quot;0&quot; + secondes_rel);
var nombre_minutes =&quot;&quot; + ((minutes_abs &gt; 9) ? minutes_abs : &quot;0&quot; + minutes_abs);
window.document.affiche.temps.value = nombre_minutes + &quot;:&quot; + nombre_secondes;
window.setTimeout('affiche_heure()',1000);
}

function calcul_temps() {
var encore_toujours = new Date();
return((encore_toujours.getTime() - Start)/1000);
}
// --&gt;
&lt;/script&gt;
&lt;/head&gt;
&lt;body bgcolor=&quot;#EEEEEE&quot; text=&quot;#000000&quot; onLoad=&quot;window.setTimeout('affiche_heure()',1000)&quot;&gt;

&lt;form name=&quot;affiche&quot; action=&quot;&quot;&gt;
&lt;input size=&quot;7&quot; name=&quot;temps&quot; value=&quot;00:00&quot;&gt;
&lt;/form&gt;

&lt;p&gt;Bon amusement dans la fen�tre cadre de droite!&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table>

<h3 class="xpl">Explication:</h3>

<h4>rechercher le temps de d&eacute;part:</h4>

<p>&Agrave; la lecture du fichier sont recherch&eacute;es dans un premier temps les date et heure actuelles, qui serviront comme temps de d&eacute;part pour l'affichage. Avec <code>maintenant = new Date()</code> est sauvegard&eacute; dans la variable <code>maintenant</code> un nouvel <img src="../../src/doc.gif" width="15" height="10" border="0" alt="Autre page d'information">&nbsp;<a href="../objets/date.htm"><b>objet Date</b></a> avec les date et heure actuelles. Avec <code>maintenant.getTime</code> est recherch&eacute; un nombre absolu en milli&egrave;mes de seconde qui est sauvegard&eacute; dans la variable <code>Start</code>.</p>

<h4>appeler la fonction pour l'affichage du temps pour la premi&egrave;re fois:</h4>

<p>Dans le rep&egrave;re d'ouverture <code>&lt;body&gt;</code> de l'exemple se trouve le premier appel de la fonction <code>affiche_heure()</code>, qui affiche le temps et actualise l'affichage chaque seconde. Le premier appel a lieu apr&egrave;s une seconde. &Agrave; cet effet, le premier appel de la fonction est incorpor&eacute; dans la m&eacute;thode <code>setTimeout()</code> avec une p&eacute;riode de retard de 1000 milli&egrave;mes de seconde (1 seconde).<br>
Dans le corps de fichier se trouve ensuite un formulaire constitu&eacute; d'un simple petit champ de saisie. Ce champ de saisie est utilis&eacute; comme champ de sortie pour l'affichage du temps. Il est occup&eacute; par une valeur par d&eacute;faut de <code>00:00</code>, afin qu'un affichage ait lieu d&egrave;s la premi&egrave;re seconde.</p>

<h4>afficher le temps et actualiser l'affichage en permanence:</h4>

<p>La fonction <code>affiche_heure()</code>, qui assure l'affichage continuel du temps, appelle d'abord la sous-fonction <code>calcul_temps()</code>. Cette fonction cr&eacute;e &agrave; chaque appel un nouvel objet Date avec date et heure actuelles. Le r&eacute;sultat est sauvegard&eacute; dans la variable <code>encore_toujours</code>. La valeur retourn&eacute;e n'est cependant pas les date et heure actuelles, mais la diff&eacute;rence entre celles-ci et les date et heure de d&eacute;part qui ont &eacute;t&eacute; recherch&eacute;es &agrave; la lecture du fichier. La valeur retourn&eacute;e est exprim&eacute;e en secondes. Pour obtenir celles-ci, la valeur est divis&eacute;e par 1000, &eacute;tant donn&eacute; que, pour un objet Date, le calcul interne est effectu&eacute; en milli&egrave;mes de secondes. Ce faisant, il peut arriver que l'on obtienne toutefois des d&eacute;cimales. Pour obtenir un nombre rond de secondes, la fonction appelante <code>affiche_heure()</code> emploie la m&eacute;thode <code>Math.round()</code>.</p>

<p>Le nombre absolu des secondes &eacute;coul&eacute;es se trouve alors dans la variable <code>secondes_abs</code>. De la valeur sauvegard&eacute;e dans <code>secondes_abs</code> sont issues toutes les valeurs suivantes. Avec <code>Math.round((secondes_abs-30)/60)</code>, il est recherch&eacute; &agrave; combien de minutes le nombre de secondes correspond. Si par exemple, le nombre de secondes est 200, cela implique que 3 minutes (180 secondes) y sont contenues. Cette valeur est sauvegard&eacute;e dans la variable <code>minutes_abs</code>. &Eacute;tant donn&eacute; qu'Opera 5.12 donne comme r&eacute;sultat de l'op&eacute;ration <code>-0</code> dans les 30 premi&egrave;res secondes, il est recherch&eacute; pour emp&ecirc;cher l'affichage d'un nombre n&eacute;gatif le montant absolu de la valeur avec <code>Math.abs</code>. Le reste en secondes (donc si l'on reprend par exemple 200 et 180 la valeur de 20 secondes) est sauvegard&eacute; avec la division modulo <code>secondes_abs % 60</code> dans la variable <code>secondes_rel</code>. Il y aura donc la valeur 3 dans <code>minutes_abs</code> et la valeur 20 dans <code>secondes_rel</code>.</p>

<p>Pour formater correctement l'affichage des minutes et secondes sont cr&eacute;&eacute;es des cha&icirc;nes de caract&egrave;res qui sont sauvegard&eacute;es dans les variables <code>nombre_secondes</code> et <code>nombre_minutes</code>. Si le nombre de minutes ou de secondes ne contient qu'un seul chiffre, un 0 est alors plac&eacute; devant.</p>

<p>Avec l'affectation &agrave; <code>window.document.affiche.temps.value</code>, le temps recherch&eacute; et format&eacute; est &eacute;crit ensuite dans le champ du formulaire servant &agrave; l'affichage. Pour que l'affichage du temps soit continu, la fonction <code>affiche_heure()</code> s'appelle &agrave; la fin elle-m&ecirc;me, avec un d&eacute;lai de 1000 milli&egrave;mes de secondes. Ainsi, c'est tout le processus qui est relanc&eacute;.</p>





<table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr><td colspan="2" bgcolor="#EEEEEE" class="doc">
&#160;<a href="#top"><img src="../../src/haut.gif" width="14" height="10" border="0" alt="vers le haut"></a>
</td></tr>
<tr><td bgcolor="#EEEEEE" class="doc" align="right"><a href="liste_liens.htm"><img src="../../src/suivant.gif" width="10" height="10" border="0" hspace="10" alt="page suivante"></a></td>
<td bgcolor="#FFFFFF"><img src="../../src/doc.gif" width="15" height="10" border="0" alt="Autre page d'information"> <a href="liste_liens.htm"><b>Liste de liens comme liste de choix</b></a>
</td></tr>
<tr>
<td bgcolor="#EEEEEE" class="doc" align="right"><a href="boutons.htm"><img src="../../src/precedent.gif" width="10" height="10" border="0" hspace="10" alt="page pr&eacute;c&eacute;dente"></a></td>
<td bgcolor="#FFFFFF" width="100%"><img src="../../src/doc.gif" width="15" height="10" border="0" alt="Autre page d'information"> <a href="boutons.htm"><b>Boutons graphiques dynamiques</b></a>
</td>
</tr>
<tr><td colspan="2" bgcolor="#EEEEEE" class="doc">&#160;</td></tr>
</table><table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr>
<td bgcolor="#FFEEDD" class="nav"><a class="an" name="bottom"><img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"></a> <a href="../../index.htm"><b>SELFHTML</b></a>/<a href="../../navigation/index.htm" target="_parent">Aides &agrave; la navigation</a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="../index.htm"><b>JavaScript/DOM</b></a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="index.htm"><b>Exemples d'application</b></a></td>
</tr>
</table>

<p>&copy; 2001 Stefan M&uuml;nz / &copy; 2003 Traduction <img src="../../src/courriel.gif" width="15" height="10" border="0" alt="Adresse &eacute;lectronique">&nbsp;<a href="mailto:13405@free.fr">Serge Fran&ccedil;ois, 13405@free.fr</a><br><img src="../../src/courriel.gif" width="15" height="10" border="0" alt="Adresse &eacute;lectronique">&nbsp;<a href="mailto:selfhtml@selfhtml.com.fr">selfhtml@selfhtml.com.fr</a></p>



</body>
</html>
