<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>SELFHTML: JavaScript / Exemples d'application / Compter les visites de pages personnelles avec des cookies</title>
<link rel="stylesheet" type="text/css" href="../../src/selfhtml.css">
<meta name="description"    content="Comment faire savoir, &agrave; l'aide de JavaScript, &agrave; l'utilisateur lorsqu'il appelle une page combien de fois il a d&eacute;j&agrave; visit&eacute; cette page. R&eacute;alis&eacute; &agrave; l'aide de cookies.">
<meta name="keywords"       content="SELFHTML, JavaScript, compteur, t&eacute;moin de connexion, Counter, Cookies, document.cookie">
<meta name="author"         content="Stefan M&uuml;nz, selfhtml@teamone.de">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<meta name="DC.Publisher"   content="Serge Fran&ccedil;ois, selfhtml@selfhtml.com.fr">
<meta name="DC.Date"        content="2003-01-27T08:00+00:00">
<meta name="DC.Identifier"  content="http://selfhtml.selfhtml.com.fr/javascript/exemples/visites_pages.htm">
<meta name="DC.Language"    content="fr">
<meta name="DC.Rights"      content="../../editorial/copyright.htm">
<meta name="DC.Date.Create" content="2003-01-27T08:00+00:00">
<meta name="SELF.Version"   content="1">
<meta name="SELF.Pagetype"  content="Information">
<meta name="SELF.Path"      content="SELFHTML == ../../index.htm // JavaScript/DOM == ../index.htm // Exemples d'application == index.htm">
<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//matomo.boitasite.com/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#AA5522" vlink="#772200" alink="#000000">

<table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr>
<td bgcolor="#FFEEDD" class="nav"><a class="an" name="top"><img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"></a> <a href="../../index.htm"><b>SELFHTML</b></a>/<a href="../../navigation/index.htm" target="_parent">Navigationshilfen</a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="../index.htm"><b>JavaScript/DOM</b></a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="index.htm"><b>Exemples d'application</b></a></td>
</tr>
</table><table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr>
<td bgcolor="#EEEEEE" class="doc" width="110"><img src="../../src/logo.gif" width="106" height="109" border="0" alt="SELFHTML"></td>
<td bgcolor="#EEEEEE" class="doc" valign="bottom" width="100%"><h2>Compter les visites de pages personnelles avec des t&eacute;moins de connexion (cookies)</h2>
<tr>
<td bgcolor="#EEEEEE" class="doc" valign="top" align="center">
<img src="../../src/docx.gif" width="30" height="20" vspace="6" border="0" alt="Page d'information: vue d'ensemble">
</td>
<td bgcolor="#FFFFFF" valign="top" nowrap>
<p>
<img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas">&nbsp;<a href="#remarques"><b>Remarques sur cet exemple</b></a><br>
<img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas">&nbsp;<a href="#texte_source"><b>Texte source avec explications</b></a><br>
</p>
<p><img src="../../src/docf.gif" width="15" height="10" border="0" alt="D&eacute;monstration - nouvelle fen&ecirc;tre">&nbsp;<a href="affichage/visites_pages.htm" target="_blank"><b>Exemple d'affichage: aper&ccedil;u</b></a></p>
</td>
</tr><tr><td colspan="2" bgcolor="#EEEEEE" class="doc">&#160;<a href="#bottom"><img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas"></a>&#160;</td></tr>
</table>



<h2 class="Sh2"><a class="an" name="remarques">Remarques sur cet exemple</a></h2>

<p>Cookies (biscuits) ou t&eacute;moins de connexion sont une possibilit&eacute; - qui n'est pas incontest&eacute;e - que Netscape a b&acirc;tie dans JavaScript. Les t&eacute;moins de connexion permettent &agrave; un programme JavaScript de sauvegarder des donn&eacute;es sur le disque dur de l'utilisateur. Cela se passe cependant de fa&ccedil;on contr&ocirc;l&eacute;e. Un "espionnage" du disque de l'utilisateur y est aussi peu possible que d'y placer du code ex&eacute;cutable, comme par exemple des virus. Car si vous &eacute;crivez un t&eacute;moin de connexion dans un JavaScript, vous ne pouvez pas mentionner o&ugrave; le t&eacute;moin de connexion sera sauvegard&eacute; chez l'utilisateur. Cela contr&ocirc;le le navigateur WWW de l'utilisateur. D'autre part, les t&eacute;moins de connexion ne peuvent pas &eacute;crire des quantit&eacute;s de donn&eacute;es incontr&ocirc;l&eacute;es sur l'ordinateur de l'utilisateur, mais seulement un nombre limit&eacute; de lignes. Chacune de ces lignes d&eacute;finit une variable et lui affecte une valeur. Un t&eacute;moin de connexion peut donc &ecirc;tre compar&eacute; &agrave; une inscription dans un fichier de configuration - avec cette diff&eacute;rence que le t&eacute;moin de connexion ne peut adresser des donn&eacute;es de configuration sur l'ordinateur de l'utilisateur.</p>

<p>Par la possibilit&eacute; de sauvegarder des donn&eacute;es, beaucoup de nouveaux domaines d'application se r&eacute;v&egrave;lent possibles pour JavaScript, tels que l'exemple d&eacute;crit ici. Car pour compter des visites de pages &eacute;tal&eacute;es dans le temps, il faut bien sauvegarder quelque part le nombre de visites faites jusqu'alors, le relire &agrave; la prochaine visite, augmenter le compteur de 1 et sauvegarder &agrave; nouveau la nouvelle valeur. C'est exactement ce que fait l'exemple d&eacute;crit ici.</p>

<h3 class="Inf">Attention:</h3>

<p>Le comptage des visites de pages personnelles diff&egrave;re sensiblement du comptage de toutes les visites de pages. Pour g&eacute;rer tous les acc&egrave;s &agrave; une page, le programme doit avoir son compteur sur l'ordinateur serveur. C'est pourquoi un &quot;compteur&quot; classique ne fonctionne qu'avec CGI. Le script d&eacute;crit ici ne compte que les visites d'un utilisateur d&eacute;termin&eacute; &agrave; une page d&eacute;termin&eacute;e.</p>








<table bgcolor="#EEEEEE" class="doc" width="100%"><tr><td>
&#160;<a href="#top"><img src="../../src/haut.gif" width="14" height="10" border="0" alt="vers le haut"></a><a href="#bottom"><img src="../../src/bas.gif" width="14" height="10" border="0" alt="vers le bas"></a>&#160;
</td></tr></table>
<h2 class="Sh2"><img src="../../src/netsc2.gif" width="30" height="30" border="0" alt="Netscape 2.0"><img src="../../src/msie3.gif" width="30" height="30" border="0" alt="MS IE 3.0">&nbsp;<a class="an" name="texte_source">Texte source avec explications</a></h2>

<p>L'exemple montre un fichier HTML complet . Le compteur s'applique &agrave; ce seul fichier.</p>

<h3 class="xmp">Exemple:</h3>

<p><img src="../../src/docf.gif" width="15" height="10" border="0" alt="D&eacute;monstration - nouvelle fen&ecirc;tre">&nbsp;<a href="affichage/visites_pages.htm" target="_blank"><b>Exemple d'affichage: aper&ccedil;u</b></a></p>

<table width="100%" cellpadding="10"><tr><td class="xmpcode" bgcolor="#FFFFE0"><pre>
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Compter les visites de pages personnelles avec des cookies &lt;/title&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
&lt;!--
function cherche_valeur() {
 var valeur = &quot;&quot;;
 if(document.cookie) {
  var valeur_depart = document.cookie.indexOf(&quot;=&quot;) + 1;
  var valeur_fin = document.cookie.indexOf(&quot;;&quot;);
  if (valeur_fin == -1)
   valeur_fin = document.cookie.length;
  valeur = document.cookie.substring(valeur_depart,valeur_fin);
 }
 return valeur;
}

function fixer_valeur(indicateur, valeur, expire) {
 var maintenant = new Date();
 var temps = new Date(maintenant.getTime() + expire);
 document.cookie = indicateur+&quot;=&quot;+valeur+&quot;; expires=&quot;+temps.toGMTString()+&quot;;&quot;;
}

function etat_compteur() {
 var peremption = 1000*60*60*24*365;
 var nombre = cherche_valeur();
 var compteur = 0;
 if(nombre != &quot;&quot;) compteur = parseInt(nombre);
 if(document.cookie) {
   compteur = compteur + 1;
   fixer_valeur(&quot;compteur&quot;,compteur,peremption);
 }
 else {
   compteur = 1;
   fixer_valeur(&quot;compteur&quot;,compteur,peremption);
 }
 return(compteur);
}
//--&gt;
&lt;/script&gt;
&lt;/head&gt;
&lt;body bgcolor=&quot;#FFFFFF&quot; text=&quot;#000000&quot;&gt;

&lt;h1&gt;Une page qui en conna&amp;icirc;t sur vous...&lt;/h1&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
&lt;!--
 var x = etat_compteur();
 document.write(&quot;&lt;p&gt;Ceci est votre &lt;b&gt;&quot; + x + &quot;ï¿½me&lt;\/b&gt; visite sur cette page!&lt;\/p&gt;&quot;);
//--&gt;
&lt;/script&gt;

&lt;p&gt;Utilisez donc la fonction actualiser/recharger de votre navigateur ...&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></table>

<h3 class="xpl">Explication:</h3>

<h4>Lire un t&eacute;moin de connexion et rechercher la valeur sauvegard&eacute;e:</h4>

<p>La <img src="../../src/doc.gif" width="15" height="10" border="0" alt="Autre page d'information">&nbsp;<a href="../langage/fonctions.htm"><b>fonction</b></a> <code>cherche_valeur()</code>, d&eacute;finie dans l'exemple, est &eacute;crite en g&eacute;n&eacute;ral. Vous pouvez utiliser cette fonction pour lire un t&eacute;moin de connexion. Si le fichier a d&eacute;j&agrave; une fois &eacute;crit un t&eacute;moin de connexion, c'est sa valeur qui sera recherch&eacute;e et retourn&eacute;e. Si aucun t&eacute;moin de connexion n'existe encore, une cha&icirc;ne de caract&egrave;res vide <code>&quot;&quot;</code> est renvoy&eacute;e.</p>

<p>Avec la requ&ecirc;te <code>if(document.cookie)</code>, la fonction recherche si un t&eacute;moin de connexion est d&eacute;j&agrave; existant. Si c'est le cas, sa valeur est recherch&eacute;e. Un t&eacute;moin de connexion est normalement constitu&eacute; d'un indicateur et d'une valeur, par exemple:<br>
<code>compteur=4</code><br>
L'indicateur est <code>compteur</code> et la valeur qui lui a &eacute;t&eacute; affect&eacute;e <code>4</code>. La fonction <code>cherche_valeur()</code> se prend la valeur en recherchant, dans le t&eacute;moin de connexion qui est sauvegard&eacute;, avec des commandes <code>indexOf()</code> le d&eacute;but et la fin de la valeur. Elle affecte cette valeur &agrave; la variable <code>valeur</code>. La variable <code>valeur</code> est renvoy&eacute;e &agrave; la fin de la fonction.</p>

<h4>&Eacute;crire le t&eacute;moin de connexion et fixer la valeur:</h4>

<p>La  fonction <code>fixer_valeur()</code>, d&eacute;finie dans l'exemple, est &eacute;crite elle aussi en g&eacute;n&eacute;ral. Cette fonction attend trois param&egrave;tres:<br>
<code>indicateur</code> est l'&eacute;l&eacute;ment avant le signe &eacute;gale, par exemple <code>compteur</code>.<br>
<code>valeur</code> est la valeur qui doit &ecirc;tre affect&eacute;e et sauvegard&eacute;e.<br>
<code>expire</code> est un nombre qui est interpr&eacute;t&eacute; comme un nombre de milli&egrave;mes de secondes . Chaque t&eacute;moin de connexion qui doit rester sauvegard&eacute; au del&agrave; de la session navigateur actuelle doit contenir une mention du moment auquel le navigateur devra effacer le t&eacute;moin de connexion. Ceci est pour &eacute;viter de sauvegarder des t&eacute;moins de connexion &eacute;ternellement. La date d'expiration du t&eacute;moin de connexion doit &ecirc;tre mentionn&eacute;e sous la forme d'un format GMT. Vous n'avez pas besoin de vous en soucier, &eacute;tant donn&eacute; que la fonction <code>fixer_valeur()</code> s'en occupe automatiquement. &Agrave; cet effet, la fonction recherche le temps pr&eacute;sent (<code>var maintenant = new Date();</code>) et calcule dans la variable <code>temps</code> un moment &agrave; venir &agrave; partir du param&egrave;tre transmis <code>expire</code> et du temps pr&eacute;sent recherch&eacute;.</p>

<p>Avec l'instruction commen&ccedil;ant par <code>document.cookie =</code>, le t&eacute;moin de connexion est &eacute;crit.</p>

<h4>fonction parente pour la gestion du t&eacute;moin de connexion:</h4>

<p>Les deux fonctions g&eacute;n&eacute;rales <code>cherche_valeur()</code> et <code>fixer_valeur()</code> ont maintenant besoin de quelques instructions g&eacute;n&eacute;rales qui g&egrave;rent le t&eacute;moin de connexion. Cela se fait, dans l'exemple, dans la fonction <code>etat_compteur()</code>. Dans un premier temps, cette fonction d&eacute;finit une valeur d'expiration qui sera transmise plus tard &agrave; la fonction <code>fixer_valeur()</code> lors de l'&eacute;criture du t&eacute;moin de connexion. Avec l'expression arithm&eacute;tique <code>1000*60*60*24*365</code> est recherch&eacute; le nombre de milli&egrave;mes de secondes d'une ann&eacute;e enti&egrave;re. Le t&eacute;moin de connexion doit donc &ecirc;tre sauvegard&eacute; un an.</p>

<p>Pour g&eacute;rer les visites de pages personnelles de l'utilisateur, la fonction <code>etat_compteur()</code> doit effectuer ce qui suit: premi&egrave;rement, elle doit rechercher l'&eacute;tat actuel du compteur, deuxi&egrave;mement, l'incr&eacute;menter de 1 et troisi&egrave;mement, sauvegarder &agrave; nouveau le nouvel &eacute;tat du compteur. S'il n'existe encore aucun t&eacute;moin de connexion, c'est &agrave; dire, si l'utilisateur visite la page pour la premi&egrave;re fois, le compteur doit &ecirc;tre fix&eacute; &agrave; 1 et sauvegard&eacute;.</p>

<p>Pour cette raison, la fonction <code>etat_compteur()</code> appelle d'abord la fonction <code>cherche_valeur()</code>, pour rechercher l'&eacute;tat actuel du compteur. La valeur renvoy&eacute;e par <code>cherche_valeur()</code> est sauvegard&eacute;e dans la variable <code>nombre</code>. Si aucun t&eacute;moin de connexion n'existe encore, se trouve ensuite dans <code>nombre</code> une cha&icirc;ne de caract&egrave;res vide <code>&quot;&quot;</code>. Si une valeur existe, <code>nombre</code> contient la valeur sous la forme d'une cha&icirc;ne de caract&egrave;res. &Eacute;tant donn&eacute; qu'il n'est pas possible de calculer avec une cha&icirc;ne de caract&egrave;res, et qu'une valeur num&eacute;rique est pourtant n&eacute;cessaire pour incr&eacute;menter le compteur, est d&eacute;finie, dans l'exemple, encore une variable num&eacute;rique nomm&eacute;e <code>compteur</code>. Avec la m&eacute;thode <code>parseInt()</code>, la valeur de <code>nombre</code> est affect&eacute;e en tant que nombre &agrave; cette variable.</p>

<p>Si un t&eacute;moin de connexion existe, le compteur est incr&eacute;ment&eacute; de 1. Ensuite, la fonction <code>fixer_valeur()</code> est appel&eacute;e et sauvegarde le t&eacute;moin de connexion. Comme indicateur est transmis le mot <code>&quot;compteur&quot;</code>, comme valeur, le contenu de la variable <code>compteur</code>, et comme date d'expiration, le contenu de la variable <code>peremption</code>.</p>

<p>Si aucun t&eacute;moin de connexion n'existe, la fonction <code>fixer_valeur()</code> est appel&eacute;e exactement de la m&ecirc;me fa&ccedil;on. Auparavant cependant, le contenu de la variable <code>compteur</code> est fix&eacute; &agrave; 1.</p>

<p>&Agrave; la fin, la fonction <code>etat_compteur()</code> retourne &agrave; l'aide de <code>return()</code> l'&eacute;tat actuel du compteur. De cette fa&ccedil;on, cette fonction peut &ecirc;tre appel&eacute;e, par exemple &agrave; un autre endroit pour une sortie dans la page, comme dans l'exemple. L&agrave; est not&eacute; dans le passage <code>body</code> un autre passage JavaScript dans lequel la fonction <code>etat_compteur()</code> est appel&eacute;e, et la valeur qu'elle retourne, donc l'&eacute;tat actuel du compteur est sauvegard&eacute;e dans la variable <code>x</code>. Enfin, le code HTML est &eacute;crit dans la fen&ecirc;tre d'affichage du navigateur avec <code>document.write</code>, en sortant aussi la variable <code>x</code>.</p>




<table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr><td colspan="2" bgcolor="#EEEEEE" class="doc">
&#160;<a href="#top"><img src="../../src/haut.gif" width="14" height="10" border="0" alt="vers le haut"></a>
</td></tr>
<tr><td bgcolor="#EEEEEE" class="doc" align="right"><a href="entrees_formulaire.htm"><img src="../../src/suivant.gif" width="10" height="10" border="0" hspace="10" alt="page suivante"></a></td>
<td bgcolor="#FFFFFF"><img src="../../src/doc.gif" width="15" height="10" border="0" alt="Autre page d'information"> <a href="entrees_formulaire.htm"><b>V&eacute;rifier les saisies de formulaire</b></a>
</td></tr>
<tr>
<td bgcolor="#EEEEEE" class="doc" align="right"><a href="mois_calendrier.htm"><img src="../../src/precedent.gif" width="10" height="10" border="0" hspace="10" alt="page pr&eacute;c&eacute;dente"></a></td>
<td bgcolor="#FFFFFF" width="100%"><img src="../../src/doc.gif" width="15" height="10" border="0" alt="Autre page d'information"> <a href="mois_calendrier.htm"><b>Calendrier du mois</b></a>
</td>
</tr>
<tr><td colspan="2" bgcolor="#EEEEEE" class="doc">&#160;</td></tr>
</table><table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr>
<td bgcolor="#FFEEDD" class="nav"><a class="an" name="bottom"><img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"></a> <a href="../../index.htm"><b>SELFHTML</b></a>/<a href="../../navigation/index.htm" target="_parent">Aides &agrave; la navigation</a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="../index.htm"><b>JavaScript/DOM</b></a> <img src="../../src/refchap.gif" width="16" height="13" border="0" alt="Renvoie au chapitre d'origine"> <a href="index.htm"><b>Exemples d'application</b></a></td>
</tr>
</table>

<p>&copy; 2001 Stefan M&uuml;nz / &copy; 2003 Traduction <img src="../../src/courriel.gif" width="15" height="10" border="0" alt="Adresse &eacute;lectronique">&nbsp;<a href="mailto:13405@free.fr">Serge Fran&ccedil;ois, 13405@free.fr</a><br><img src="../../src/courriel.gif" width="15" height="10" border="0" alt="Adresse &eacute;lectronique">&nbsp;<a href="mailto:selfhtml@selfhtml.com.fr">selfhtml@selfhtml.com.fr</a></p>



</body>
</html>
