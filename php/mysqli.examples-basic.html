<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Exemples basique de l'extension MySQLi</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli.examples.html">« Exemples</a></li>
      <li style="float: right;"><a href="class.mysqli.html">mysqli »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqli.examples.html">Exemples</a></li>
    <li>Exemples basique de l'extension MySQLi</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli.examples-basic" class="section">
  <h2 class="title">Exemples basique de l&#039;extension MySQLi</h2>
  <p class="para">
   Cet exemple montre comment se connecter, exécuter une requête,
   utiliser un gestionnaire d&#039;erreur basique, afficher les lignes résultantes,
   et se déconnecter d&#039;une base de données MySQL.
  </p>
  <p class="para">
   Cet exemple utilise la base de données Sakila librement disponible qui
   peut être téléchargé depuis <a href="http://dev.mysql.com/doc/sakila/en/index.html" class="link external">&raquo;&nbsp;dev.mysql.com,
   as described here</a>. Pour faire fonctionner cet exemple, (a) installer sakila 
   et (b) modifier les variables de connexion (host, votre_utilisateur, votre_mdp).
  </p>
  <div class="example" id="example-1804">
   <p><strong>Exemple #1 Exemple de vue d&#039;ensemble de l&#039;extension MySQLi</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Passons&nbsp;une&nbsp;variable&nbsp;$_GET&nbsp;à&nbsp;notre&nbsp;exemple,&nbsp;dans&nbsp;ce&nbsp;cas<br />//&nbsp;c'est&nbsp;aid&nbsp;pour&nbsp;actor_id&nbsp;dans&nbsp;notre&nbsp;base&nbsp;de&nbsp;données&nbsp;Sakila.<br />//&nbsp;Rendons&nbsp;le&nbsp;par&nbsp;défaut&nbsp;à&nbsp;1,&nbsp;et&nbsp;transtypons&nbsp;le&nbsp;en&nbsp;entier&nbsp;pour&nbsp;éviter<br />//&nbsp;les&nbsp;injections&nbsp;SQL&nbsp;et&nbsp;/&nbsp;ou&nbsp;des&nbsp;problèmes&nbsp;de&nbsp;sécurité&nbsp;connexe.<br />//&nbsp;Gérer&nbsp;tout&nbsp;ceci&nbsp;sort&nbsp;du&nbsp;cadre&nbsp;de&nbsp;cet&nbsp;exemple&nbsp;basique.&nbsp;Exemple&nbsp;:<br />//&nbsp;&nbsp;&nbsp;http://example.org/script.php?aid=42<br /></span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'aid'</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">is_numeric</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'aid'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$aid&nbsp;</span><span style="color: #007700">=&nbsp;(int)&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'aid'</span><span style="color: #007700">];<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$aid&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Se&nbsp;connecter&nbsp;et&nbsp;sélectioner&nbsp;une&nbsp;base&nbsp;de&nbsp;données&nbsp;MySQL&nbsp;nommé&nbsp;sakila<br />//&nbsp;Hostname:&nbsp;127.0.0.1,&nbsp;username:&nbsp;votre_utilisateur,&nbsp;password:&nbsp;votre_mdp,&nbsp;db:&nbsp;sakila<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'votre_utilisateur'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'votre_mdp'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'sakila'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Oh&nbsp;non&nbsp;!&nbsp;Une&nbsp;connect_errno&nbsp;existe&nbsp;donc&nbsp;la&nbsp;tentative&nbsp;de&nbsp;connexion&nbsp;a&nbsp;échoué&nbsp;!<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect_errno</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;La&nbsp;connexion&nbsp;a&nbsp;échoué.&nbsp;Que&nbsp;voulez-vous&nbsp;faire&nbsp;?&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Vous&nbsp;pourriez&nbsp;vous&nbsp;contacter&nbsp;(email&nbsp;?),&nbsp;enregistrer&nbsp;l'erreur,&nbsp;afficher&nbsp;une&nbsp;jolie&nbsp;page,&nbsp;etc.<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Vous&nbsp;ne&nbsp;voulez&nbsp;pas&nbsp;révéler&nbsp;des&nbsp;informations&nbsp;sensibles<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Essayons&nbsp;ceci&nbsp;:<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Désolé,&nbsp;le&nbsp;site&nbsp;web&nbsp;subit&nbsp;des&nbsp;problèmes."</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Quelque&nbsp;chose&nbsp;que&nbsp;vous&nbsp;ne&nbsp;devriez&nbsp;pas&nbsp;faire&nbsp;sur&nbsp;un&nbsp;site&nbsp;public,<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;mais&nbsp;cette&nbsp;exemple&nbsp;vous&nbsp;montrera&nbsp;quand&nbsp;même&nbsp;comment&nbsp;afficher&nbsp;des<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;informations&nbsp;lié&nbsp;à&nbsp;l'erreur&nbsp;MySQL&nbsp;--&nbsp;vous&nbsp;voulez&nbsp;peut&nbsp;être&nbsp;enregistrer&nbsp;ceci<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Error:&nbsp;Échec&nbsp;d'établir&nbsp;une&nbsp;connexion&nbsp;MySQL,&nbsp;voici&nbsp;pourquoi&nbsp;:&nbsp;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Errno:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect_errno&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Error:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect_error&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Vous&nbsp;voulez&nbsp;peut&nbsp;être&nbsp;leurs&nbsp;afficher&nbsp;quelque&nbsp;chose&nbsp;de&nbsp;jolie,&nbsp;nous&nbsp;ferons&nbsp;simplement&nbsp;un&nbsp;exit<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">exit;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Réaliser&nbsp;une&nbsp;requête&nbsp;SQL<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;actor_id,&nbsp;first_name,&nbsp;last_name&nbsp;FROM&nbsp;actor&nbsp;WHERE&nbsp;actor_id&nbsp;=&nbsp;</span><span style="color: #0000BB">$aid</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />if&nbsp;(!</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Oh&nbsp;non&nbsp;!&nbsp;La&nbsp;requête&nbsp;a&nbsp;échoué.&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Désolé,&nbsp;le&nbsp;site&nbsp;web&nbsp;subit&nbsp;des&nbsp;problèmes."</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Denouveau,&nbsp;ne&nbsp;faite&nbsp;pas&nbsp;ceci&nbsp;sur&nbsp;un&nbsp;site&nbsp;public,&nbsp;mais&nbsp;nous&nbsp;vous<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;montrerons&nbsp;comment&nbsp;récupérer&nbsp;les&nbsp;informations&nbsp;de&nbsp;l'erreur<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Error:&nbsp;Notre&nbsp;requête&nbsp;a&nbsp;échoué&nbsp;lors&nbsp;de&nbsp;l'exécution&nbsp;et&nbsp;voici&nbsp;pourquoi&nbsp;:\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Query:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Errno:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errno&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Error:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Phew,&nbsp;nous&nbsp;avons&nbsp;réussie.&nbsp;Nous&nbsp;savons&nbsp;que&nbsp;la&nbsp;connexion&nbsp;MySQL&nbsp;et&nbsp;la&nbsp;requête&nbsp;<br />//&nbsp;a&nbsp;réussi,&nbsp;mais&nbsp;avons&nbsp;nous&nbsp;un&nbsp;résultat&nbsp;?<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">num_rows&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Oh,&nbsp;pas&nbsp;de&nbsp;lignes&nbsp;!&nbsp;Dès&nbsp;fois&nbsp;c'est&nbsp;acceptable&nbsp;et&nbsp;attendue,&nbsp;dès&nbsp;fois<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;ce&nbsp;l'est&nbsp;pas.&nbsp;Vous&nbsp;décidez.&nbsp;Dans&nbsp;ce&nbsp;cas,&nbsp;peut&nbsp;être&nbsp;que&nbsp;actor_id&nbsp;était&nbsp;trop<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;large&nbsp;?<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Nous&nbsp;n'avons&nbsp;pas&nbsp;trouvé&nbsp;de&nbsp;correspondance&nbsp;pour&nbsp;ID&nbsp;</span><span style="color: #0000BB">$aid</span><span style="color: #DD0000">,&nbsp;nous&nbsp;sommes&nbsp;désolé.&nbsp;Veuillez&nbsp;réessayer&nbsp;de&nbsp;nouveau."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Maintenant,&nbsp;nous&nbsp;savons&nbsp;qu'un&nbsp;seul&nbsp;résultat&nbsp;existera&nbsp;dans&nbsp;cet&nbsp;exemple&nbsp;donc<br />//&nbsp;récupérons&nbsp;le&nbsp;dans&nbsp;un&nbsp;tableau&nbsp;associatif&nbsp;où&nbsp;les&nbsp;clés&nbsp;du&nbsp;tableau&nbsp;sont<br />//&nbsp;les&nbsp;noms&nbsp;de&nbsp;colonnes&nbsp;de&nbsp;la&nbsp;table<br /></span><span style="color: #0000BB">$actor&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">();<br />echo&nbsp;</span><span style="color: #DD0000">"Parfois&nbsp;je&nbsp;vois&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$actor</span><span style="color: #007700">[</span><span style="color: #DD0000">'first_name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$actor</span><span style="color: #007700">[</span><span style="color: #DD0000">'last_name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;à&nbsp;la&nbsp;TV."</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Maintenant,&nbsp;récupérons&nbsp;cinq&nbsp;acteurs&nbsp;aléatoires&nbsp;et&nbsp;affichons&nbsp;leurs&nbsp;noms&nbsp;dans&nbsp;une&nbsp;liste.<br />//&nbsp;Nous&nbsp;ajouterons&nbsp;moins&nbsp;de&nbsp;gestion&nbsp;d'erreur&nbsp;car&nbsp;vous&nbsp;savez&nbsp;désormais&nbsp;faire&nbsp;ceci&nbsp;vous-même.<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;actor_id,&nbsp;first_name,&nbsp;last_name&nbsp;FROM&nbsp;actor&nbsp;ORDER&nbsp;BY&nbsp;rand()&nbsp;LIMIT&nbsp;5"</span><span style="color: #007700">;<br />if&nbsp;(!</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Désolé,&nbsp;le&nbsp;site&nbsp;web&nbsp;subit&nbsp;des&nbsp;problèmes."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Affichons&nbsp;nos&nbsp;5&nbsp;acteurs&nbsp;aléatoires,&nbsp;et&nbsp;un&nbsp;lien&nbsp;pour&nbsp;chaque&nbsp;acteur<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"&lt;ul&gt;\n"</span><span style="color: #007700">;<br />while&nbsp;(</span><span style="color: #0000BB">$actor&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;&lt;a&nbsp;href='"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'SCRIPT_FILENAME'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"?aid="&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$actor</span><span style="color: #007700">[</span><span style="color: #DD0000">'actor_id'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"'&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$actor</span><span style="color: #007700">[</span><span style="color: #DD0000">'first_name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">'&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$actor</span><span style="color: #007700">[</span><span style="color: #DD0000">'last_name'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/a&gt;&lt;/li&gt;\n"</span><span style="color: #007700">;<br />}<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/ul&gt;\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Le&nbsp;script&nbsp;libérera&nbsp;automatiquement&nbsp;le&nbsp;résultat&nbsp;et&nbsp;fermera&nbsp;la&nbsp;connexion<br />//&nbsp;MySQL&nbsp;quand&nbsp;elle&nbsp;existe,&nbsp;mais&nbsp;faisons&nbsp;le&nbsp;quand&nbsp;même<br /></span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div></div></div></body></html>