<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Filtres de compression</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="filters.convert.html">« Filtres de conversion</a></li>
      <li style="float: right;"><a href="filters.encryption.html">Filtres de chiffrement »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="filters.html">Liste des filtres standards</a></li>
    <li>Filtres de compression</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="filters.compression" class="section">
  <h2 class="title">Filtres de compression</h2>

  <p class="simpara">
   Alors que les <a href="wrappers.compression.html" class="link">enveloppes de
   compression</a>  fournissent un moyen pour générer des fichiers aux
   formats gzip et bz2, ils ne permettent pas de gérer les protocoles réseaux
   compressés, ni de commencer avec un flux non compressé pour le transformer
   en flux compressé. Pour cela, un filtre de compression peut être appliqué
   à tout moment sur n&#039;importe quelle ressource de flux.
  </p>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    Les filtres de compression <em class="emphasis">ne génèrent pas</em> les en-têtes
    et fins de fichiers, comme le fait l&#039;utilitaire <code class="literal">gzip</code>.
    Ils ne font que compresser et décompresser des portions de flux de données.
   </span>
  </p></blockquote>

  <div class="section" id="filters.compression.zlib">
   <h2 class="title">zlib.deflate and zlib.inflate</h2>
   <p class="simpara">
    <code class="literal">zlib.deflate</code> (compression) et
    <code class="literal">zlib.inflate</code> (décompression) sont les implémentations
    des méthodes de compression présentées dans la
    <a href="http://www.faqs.org/rfcs/rfc1951" class="link external">&raquo;&nbsp;RFC 1951</a>.
    Le filtre <code class="literal">deflate</code> prend jusqu&#039;à trois paramètres, passés
    sous la forme de <a href="language.types.array.html" class="link">tableau</a> associatif.

    <code class="parameter">level</code> spécifie le niveau de compression souhaité,
    de 1 à 9. Plus le niveau est haut, meilleure est la compression, et plus
    cher est le coût de compression. Deux niveaux de compression spéciaux
    existent : 0, qui représente l&#039;absence de compression, et -1, qui
    représente le niveau par défaut de zlib : actuellement, 6.

    <code class="parameter">window</code> est la taille du tampon mémoire, en base 2.
    Les valeurs supérieures, jusqu&#039;à 15, soit 32768 octets, donnent de meilleures
    compressions, et les valeurs inférieures, jusqu&#039;à 9, soit 512 octets,
    occupent le moins d&#039;espace en mémoire. Par défaut,
    <code class="parameter">window</code> vaut actuellement <strong><code>15</code></strong>.

    <code class="parameter">memory</code> est une indication du niveau de mémoire
    nécessaire.
    Les valeurs valides vont de 1, pour l&#039;allocation minimale, à 9, pour une
    allocation maximale. L&#039;allocation de mémoire affecte la vitesse d&#039;exécution,
    et non pas le coût global.
   </p>

   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <span class="simpara">
     Comme le niveau de compression est le paramètre le plus courant, il peut
     aussi être fourni en tant que valeur <a href="language.types.integer.html" class="link">entier</a>, au lieu d&#039;un <a href="language.types.array.html" class="link">tableau</a>.
    </span>
   </p></blockquote>

   <p class="simpara">
    Les filtres de compression zlib.* sont disponibles avec PHP à partir de la
    version <code class="literal">5.1.0</code> si le support de
    <a href="ref.zlib.html" class="link">zlib</a> est activé.
    Ils sont également disponibles pour les versions <code class="literal">5.0.x</code>
    en installant le paquet
    <a href="https://pecl.php.net/package/zlib_filter" class="link external">&raquo;&nbsp;zlib_filter</a>
    depuis <a href="https://pecl.php.net/" class="link external">&raquo;&nbsp;PECL</a>.
   </p>

   <div class="example" id="example-6259">
    <p><strong>Exemple #1 
     <code class="literal">zlib.deflate</code> and
     <code class="literal">zlib.inflate</code>
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$params&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'level'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">6</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'window'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">15</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'memory'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">9</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$original_text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"This&nbsp;is&nbsp;a&nbsp;test.\nThis&nbsp;is&nbsp;only&nbsp;a&nbsp;test.\nThis&nbsp;is&nbsp;not&nbsp;an&nbsp;important&nbsp;string.\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Le&nbsp;texte&nbsp;original&nbsp;est&nbsp;long&nbsp;de&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$original_text</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;octets.\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.deflated'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">stream_filter_append</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'zlib.deflate'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">STREAM_FILTER_WRITE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$params</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$original_text</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Le&nbsp;fichier&nbsp;compressé&nbsp;fait&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">filesize</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.deflated'</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;octets&nbsp;de&nbsp;long.\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Le&nbsp;texte&nbsp;original&nbsp;était&nbsp;:\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">/*&nbsp;Utilise&nbsp;readfile&nbsp;et&nbsp;zlib.inflate&nbsp;pour&nbsp;décompresser&nbsp;à&nbsp;la&nbsp;volée&nbsp;*/<br /></span><span style="color: #0000BB">readfile</span><span style="color: #007700">(</span><span style="color: #DD0000">'php://filter/zlib.inflate/resource=test.deflated'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;Affiche&nbsp;:<br /><br />Le&nbsp;texte&nbsp;original&nbsp;est&nbsp;long&nbsp;de&nbsp;70&nbsp;octets<br />Le&nbsp;fichier&nbsp;compressé&nbsp;fait&nbsp;56&nbsp;octets&nbsp;de&nbsp;long.<br />Le&nbsp;texte&nbsp;original&nbsp;était&nbsp;:<br />This&nbsp;is&nbsp;a&nbsp;test.<br />This&nbsp;is&nbsp;only&nbsp;a&nbsp;test.<br />This&nbsp;is&nbsp;not&nbsp;an&nbsp;important&nbsp;string.<br /><br />&nbsp;*/<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>

   <div class="example" id="example-6260">
    <p><strong>Exemple #2 
     <code class="literal">zlib.deflate</code> simple
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$original_text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"This&nbsp;is&nbsp;a&nbsp;test.\nThis&nbsp;is&nbsp;only&nbsp;a&nbsp;test.\nThis&nbsp;is&nbsp;not&nbsp;an&nbsp;important&nbsp;string.\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Le&nbsp;texte&nbsp;original&nbsp;est&nbsp;long&nbsp;de&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$original_text</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;octets.\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.deflated'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">/*&nbsp;Ici,&nbsp;"6"&nbsp;indique&nbsp;le&nbsp;niveau&nbsp;de&nbsp;compression&nbsp;de&nbsp;6&nbsp;*/<br /></span><span style="color: #0000BB">stream_filter_append</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'zlib.deflate'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">STREAM_FILTER_WRITE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">6</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$original_text</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Le&nbsp;fichier&nbsp;compressé&nbsp;fait&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">filesize</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.deflated'</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;octets&nbsp;de&nbsp;long.\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*&nbsp;Affiche&nbsp;:<br /><br />Le&nbsp;texte&nbsp;original&nbsp;est&nbsp;long&nbsp;de&nbsp;70&nbsp;octets<br />Le&nbsp;fichier&nbsp;compressé&nbsp;fait&nbsp;56&nbsp;octets&nbsp;de&nbsp;long.<br /><br />&nbsp;*/<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </div>

  <div class="section" id="filters.compression.bzip2">
   <h2 class="title">bzip2.compress and bzip2.decompress</h2>
   <p class="simpara">
    <code class="literal">bzip2.compress</code> et
    <code class="literal">bzip2.decompress</code>
    fonctionnent de la même manière que les filtres zlib décrit ci-dessus.
    Le filtre <code class="literal">bzip2.compress</code> accepte jusqu&#039;à 2 paramètres,
    sous la forme d&#039;un <a href="language.types.array.html" class="link">tableau</a> associatif :

    <code class="parameter">blocks</code> est une valeur <a href="language.types.integer.html" class="link">entier</a>, de 1 à 9,
    spécifiant le nombre de blocs de 100 kb de mémoire à allouer à l&#039;espace de
    travail.

    <code class="parameter">work</code> est aussi un <a href="language.types.integer.html" class="link">entier</a> dont la valeur va de
    0 à 250, et qui indique le niveau d&#039;efforts fournis avec une méthode de
    compression avant de passer à une autre méthode, plus lente. Modifier ce
    paramètre n&#039;a qu&#039;un effet sur la vitesse de compression. Le gain d&#039;espace
    ou la mémoire utilisée restent les mêmes. Un niveau de 0 indique que la
    bibliothèque doit utiliser sa configuration par défaut.

    Le filtre <code class="literal">bzip2.decompress</code> accepte uniquement un paramètre,
    qui peut être passé sous la forme d&#039;un <a href="language.types.boolean.html" class="link">booléen</a>, ou en tant que l&#039;élément
    <code class="parameter">small</code> d&#039;un <a href="language.types.array.html" class="link">tableau</a> associatif.

    <code class="parameter">small</code>, lorsque définit à <strong><code>TRUE</code></strong>, indique à la
    bibliothèque bzip qu&#039;elle doit faire une décompression en utilisant le
    moins de mémoire possible, aux dépends de la vitesse.
   </p>

   <p class="simpara">
    Les filtres bzip2.* sont disponibles avec PHP à partir de la
    version <code class="literal">5.1.0</code> si le support de
    <a href="ref.bzip2.html" class="link">bz2</a> est activé.
    Ils sont également disponibles pour les versions <code class="literal">5.0.x</code>
    en installant le paquet
    <a href="https://pecl.php.net/package/bz2_filter" class="link external">&raquo;&nbsp;bz2_filter</a>
    depuis <a href="https://pecl.php.net/" class="link external">&raquo;&nbsp;PECL</a>.
   </p>

   <div class="example" id="example-6261">
    <p><strong>Exemple #3 
     <code class="literal">bzip2.compress</code> et
     <code class="literal">bzip2.decompress</code>
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$param&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'blocks'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">9</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'work'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Le&nbsp;texte&nbsp;original&nbsp;est&nbsp;long&nbsp;de&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">LICENSE</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;octets.\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'LICENSE.compressed'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">stream_filter_append</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'bzip2.compress'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">STREAM_FILTER_WRITE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$param</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">'LICENSE'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Le&nbsp;fichier&nbsp;compressé&nbsp;fait&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">filesize</span><span style="color: #007700">(</span><span style="color: #DD0000">'LICENSE.compressed'</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;octets&nbsp;de&nbsp;long.\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*&nbsp;Affiche&nbsp;:<br /><br />Le&nbsp;texte&nbsp;original&nbsp;est&nbsp;long&nbsp;de&nbsp;3288&nbsp;octets.<br />Le&nbsp;fichier&nbsp;compressé&nbsp;fait&nbsp;1488&nbsp;octets&nbsp;de&nbsp;long.<br /><br />&nbsp;*/<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </div>
  </div></div></div></body></html>