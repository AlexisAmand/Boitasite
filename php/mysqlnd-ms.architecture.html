<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Architecture</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqlnd-ms.concepts.html">« Concepts</a></li>
      <li style="float: right;"><a href="mysqlnd-ms.pooling.html">Groupe de connexions et bascule entre les connexions »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqlnd-ms.concepts.html">Concepts</a></li>
    <li>Architecture</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqlnd-ms.architecture" class="section">
  <h2 class="title">Architecture</h2>
  <p class="para">
   Le plugin mysqlnd de réplication et de répartition de charge est implémenté sous
   forme d&#039;extension PHP. Il est écrit en C et agit sous PHP et durant la phase de
   démarrage de l&#039;interpréteur PHP (phase d&#039;initialisation des modules) il est enregistré
   comme plugin <a href="book.mysqlnd.html" class="link">mysqlnd</a> pour remplacer des fonctions
   C spécifiques.
  </p>
  <p class="para">
   Au déroulement de PHP, il inspecte les requêtes envoyées depuis mysqlnd(PHP) au serveur
   MySQL. Si une requête est reconnue comme étant de type lecture seule, elle sera aiguillée
   vers un des serveurs esclaves configurés. Ceci est le cas pour les requêtes commençant
   par <code class="literal">SELECT</code>, au moyen de l&#039;astuce SQL <code class="literal">/*ms=slave*/</code> ou alors
   si un esclave a été choisi pour exécuter la requête précédente et qu&#039;elle utilisait l&#039;astuce
   SQL <code class="literal">/*ms=last_used*/</code>. Dans tous les autres cas, la requête sera envoyée au
   serveur maitre.
  </p>
  <p class="para">
   Les applications doivent utiliser les 
   <a href="mysqlnd-ms.constants.html" class="link">constantes prédéfinies</a>
   <strong><code>MYSQLND_MS_MASTER_SWITCH</code></strong>,
   <strong><code>MYSQLND_MS_SLAVE_SWITCH</code></strong> et
   <strong><code>MYSQLND_MS_LAST_USED_SWITCH</code></strong>
   au lieu de leurs valeurs littérales, comme
   <code class="literal">/*ms=slave*/</code>, et ce, dans un souci de portabilité.
  </p>
  <p class="para">
   Le plugin se charge en interne d&#039;ouvrir et fermer des connexions au maitre et aux esclaves.
   Du point de vue de l&#039;application, il n&#039;y a qu&#039;une seule connexion visible. Cependant, en interne,
   cette connexion est représentée par un groupe de connexions réseaux gérées par le plugin.
   Le plugin aiguille les requêtes vers le maitre ou les esclaves en utilisant de multiples
   connexions.
  </p>
  <p class="para">
   Les connexions aux bases de données ont des états, par exemple, le statut des transactions,
   lejeu de caractères, les tables temporaires. Le plugin va tenter de garder les états des
   connexions de manière transparente pour les requêtes qu&#039;il traite, lorsque cela lui est
   possible. Dans les cas contraires, comme par exemple via l&#039;utilisation de
   <code class="literal">BEGIN TRANSACTION</code>, le plugin laisse l&#039;utilisateur gérer les connexions.
  </p>  
 </div></div></div></body></html>