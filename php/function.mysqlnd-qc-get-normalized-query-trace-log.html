<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Retourne une trace dans les logs d'une requ&ecirc;te normalis&eacute;e pour chaque requ&ecirc;te inspect&eacute;e par le cache de requ&ecirc;tes</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysqlnd-qc-get-core-stats.html">« mysqlnd_qc_get_core_stats</a></li>
      <li style="float: right;"><a href="function.mysqlnd-qc-get-query-trace-log.html">mysqlnd_qc_get_query_trace_log »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysqlnd-qc.html">Fonctions mysqlnd_qc</a></li>
    <li>Retourne une trace dans les logs d'une requ&ecirc;te normalis&eacute;e pour chaque requ&ecirc;te inspect&eacute;e par le cache de requ&ecirc;tes</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysqlnd-qc-get-normalized-query-trace-log" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqlnd_qc_get_normalized_query_trace_log</h1>
  <p class="verinfo">(PECL mysqlnd_qc &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">mysqlnd_qc_get_normalized_query_trace_log</span> &mdash; <span class="dc-title">Retourne une trace dans les logs d&#039;une requête normalisée pour chaque requête inspectée par le cache de requêtes</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.mysqlnd-qc-get-normalized-query-trace-log-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   
   <span class="methodname"><strong>mysqlnd_qc_get_normalized_query_trace_log</strong></span>
    ( <span class="methodparam">void</span>
   ) : <span class="type">array</span></div>

  <p class="para rdfs-comment">
   Retourne une trace dans les logs d&#039;une requête normalisée pour chaque
   requête inspectée par le cache de requêtes. La collection de trace de logs
   est désactivée par défaut. Pour collecter les traces de log, vous devez définir la
   directive de configuration PHP
   <code class="literal">mysqlnd_qc.collect_normalized_query_trace</code> à
   <code class="literal">1</code>.
  </p>
  <p class="para">
   Les entrées de trace de logs sont groupées par requête normalisée.
   La requête normalisée est la requête avec toutes les valeurs de paramètres
   de requête remplacées par un marqueur. Par exemple, les deux requêtes
   <code class="literal">SELECT id FROM test WHERE id = 1</code> et
   <code class="literal">SELECT id FROM test WHERE id = 2</code> sont normalisées en
   <code class="literal">SELECT id FROM test WHERE id = ?</code>. Chaque fois qu&#039;une
   requête est inspectée par le cache de requête qui correspond au masque de
   requête normalisée, ses statistiques sont groupées par la chaîne de requête
   normalisée.
  </p>
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.mysqlnd-qc-get-normalized-query-trace-log-parameters">
  <h3 class="title">Liste de paramètres</h3>
  <p class="para">Cette fonction ne contient aucun paramètre.</p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.mysqlnd-qc-get-normalized-query-trace-log-returnvalues">
  <h3 class="title">Valeurs de retour</h3>
  <p class="para">
   Un tableau de log de requêtes. Chaque entrée contient la chaîne de requête
   normalisée en plus d&#039;autres informations.
  </p>
  
  <table class="doctable informaltable">
   
    <col width="1*" />
    <col width="9*" />
    <thead>
     <tr>
      <th>Clé</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>
       <code class="literal">query</code>
      </td>
      <td>
       Chaîne de requête normalisée.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">occurences</code>
      </td>
      <td>
       Le nombre de requêtes qui ont correspondu à la chaîne de requête
       normalisée en plus de celle qui a créée l&#039;entrée du log.
       La valeur est zéro si une requête a été normalisée, sa représentation
       normalisée a été ajoutée au log mais qu&#039;aucune autre requête inspectée
       par PECL/mysqlnd_qc n&#039;avait la même chaîne de requête normalisée.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">eligible_for_caching</code>
      </td>
      <td>
       Si la requête doit être mise en cache ou non. Une requête
       éligible pour la mise en cache ne sera pas nécessairement
       mise en cache. Il n&#039;est pas possible de dire avec certitude
       si et combien de requêtes mises en cache a contribué
       à l&#039;aggrégation de l&#039;entrée du log de requête normalisée.
       Cependant, la comparaison du temps minimum d&#039;exécution
       et du temps moyenne d&#039;exécution permet de faire une supposition
       relativement juste.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">avg_run_time</code>
      </td>
      <td>
       La durée d&#039;exécution moyen de toutes les requêtes ayant
       contribuées à l&#039;entrée du log. La durée d&#039;exécution
       est le temps entre l&#039;envoi de la requête à MySQL et la
       réception de la réponse depuis MySQL.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">avg_store_time</code>
      </td>
      <td>
       La durée moyenne de stockage de toutes les requêtes ayant
       contribuées à l&#039;entrée du log. La durée de stockage
       est le temps nécessaire pour récupérer un jeu de résultats
       d&#039;une requête depuis le serveur vers le client, et le
       stocker sur le client.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">min_run_time</code>
      </td>
      <td>
       La durée minimale d&#039;exécution de toutes les requêtes ayant
       contribuées à l&#039;entrée du log.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">min_store_time</code>
      </td>
      <td>
       La durée minimale de stockage de toutes les requêtes ayant
       contribuées à l&#039;entrée du log.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">max_run_time</code>
      </td>
      <td>
       La durée maximale d&#039;exécution de toutes les requêtes ayant contribuées
       à l&#039;entrée du log.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">max_store_time</code>
      </td>
      <td>
       La durée maximale de stockage de toutes les requêtes ayant contribuées
       à l&#039;entrée du log.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>

 
 
 <div class="refsect1 examples" id="refsect1-function.mysqlnd-qc-get-normalized-query-trace-log-examples">
  <h3 class="title">Exemples</h3>
  <div class="example" id="example-2281">
   <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_qc.collect_normalized_query_trace=1</pre>
</div>
   </div>

   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Connexion,&nbsp;création&nbsp;et&nbsp;peuplement&nbsp;de&nbsp;la&nbsp;table&nbsp;test&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"host"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"schema"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"port"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"socket"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1),&nbsp;(2)"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;Non&nbsp;mise&nbsp;en&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;1"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*&nbsp;Mise&nbsp;en&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"/*"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">MYSQLND_QC_ENABLE_SWITCH&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"*/"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;2"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*&nbsp;Récupération&nbsp;depuis&nbsp;le&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"/*"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">MYSQLND_QC_ENABLE_SWITCH&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"*/"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;2"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_qc_get_normalized_query_trace_log</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Les exemples ci-dessus vont afficher :</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
array(1) {
  [&quot;id&quot;]=&gt;
  string(1) &quot;1&quot;
}
array(1) {
  [&quot;id&quot;]=&gt;
  string(1) &quot;2&quot;
}
array(1) {
  [&quot;id&quot;]=&gt;
  string(1) &quot;2&quot;
}
array(4) {
  [0]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(25) &quot;DROP TABLE IF EXISTS test&quot;
    [&quot;occurences&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;avg_run_time&quot;]=&gt;
    int(0)
    [&quot;min_run_time&quot;]=&gt;
    int(0)
    [&quot;max_run_time&quot;]=&gt;
    int(0)
    [&quot;avg_store_time&quot;]=&gt;
    int(0)
    [&quot;min_store_time&quot;]=&gt;
    int(0)
    [&quot;max_store_time&quot;]=&gt;
    int(0)
  }
  [1]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(27) &quot;CREATE TABLE test (id INT )&quot;
    [&quot;occurences&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;avg_run_time&quot;]=&gt;
    int(0)
    [&quot;min_run_time&quot;]=&gt;
    int(0)
    [&quot;max_run_time&quot;]=&gt;
    int(0)
    [&quot;avg_store_time&quot;]=&gt;
    int(0)
    [&quot;min_store_time&quot;]=&gt;
    int(0)
    [&quot;max_store_time&quot;]=&gt;
    int(0)
  }
  [2]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(40) &quot;INSERT INTO test (id ) VALUES (? ), (? )&quot;
    [&quot;occurences&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;avg_run_time&quot;]=&gt;
    int(0)
    [&quot;min_run_time&quot;]=&gt;
    int(0)
    [&quot;max_run_time&quot;]=&gt;
    int(0)
    [&quot;avg_store_time&quot;]=&gt;
    int(0)
    [&quot;min_store_time&quot;]=&gt;
    int(0)
    [&quot;max_store_time&quot;]=&gt;
    int(0)
  }
  [3]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(31) &quot;SELECT id FROM test WHERE id =?&quot;
    [&quot;occurences&quot;]=&gt;
    int(2)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(true)
    [&quot;avg_run_time&quot;]=&gt;
    int(159)
    [&quot;min_run_time&quot;]=&gt;
    int(12)
    [&quot;max_run_time&quot;]=&gt;
    int(307)
    [&quot;avg_store_time&quot;]=&gt;
    int(10)
    [&quot;min_store_time&quot;]=&gt;
    int(8)
    [&quot;max_store_time&quot;]=&gt;
    int(13)
  }
}
</pre></div>
   </div>
   
  </div>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.mysqlnd-qc-get-normalized-query-trace-log-seealso">
  <h3 class="title">Voir aussi</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member">
     <a href="mysqlnd-qc.configuration.html" class="link">Configuration de l&#039;exécution</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.collect-query-trace" class="link">mysqlnd_qc.collect_normalized_query_trace</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.time-statistics" class="link">mysqlnd_qc.time_statistics</a>
    </li>
    <li class="member">
     <span class="function"><a href="function.mysqlnd-qc-get-query-trace-log.html" class="function" rel="rdfs-seeAlso">mysqlnd_qc_get_query_trace_log()</a> - Retourne une trace pour chaque requ&ecirc;te inspect&eacute;e par la mise en cache de requ&ecirc;tes</span>
    </li>
   </ul>
  </p>
 </div>

 
</div></div></div></body></html>