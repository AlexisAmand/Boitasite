<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>L'API du plugin mysqlnd</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqlnd.plugin.architecture.html">« Architecture du plugin du driver natif</a></li>
      <li style="float: right;"><a href="mysqlnd.plugin.developing.html">Bien commencer la compilation d'un plugin mysqlnd »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqlnd.plugin.html">API du plugin du driver natif MySQL</a></li>
    <li>L'API du plugin mysqlnd</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqlnd.plugin.api" class="section">
  <h2 class="title">L&#039;API du plugin mysqlnd</h2>
  <p class="para">
   Voici la liste des fonctions fournies dans l&#039;API plugin
   <code class="literal">mysqlnd</code> :
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_register()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_count()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_connection_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_result_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_stmt_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_net_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_plugin_get_plugin_protocol_data()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_conn_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_result_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_result_meta_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_stmt_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_net_get_methods()
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     mysqlnd_protocol_get_methods()
    </p>
   </li>
  </ul>
  <p class="para">
   Il n&#039;y a pas de définition formelle de ce qu&#039;est un plugin
   ainsi de la façon dont fonctionne un plugin.
  </p>
  <p class="para">
   Les composants les plus souvent trouvés dans les mécanismes de plugin sont :
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     Un gestionnaire de plugin
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Une API du plugin
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Les services applicatifs (ou modules)
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Les APIs des services applicatifs (ou APIs du module)
    </p>
   </li>
  </ul>
  <p class="para">
   Le concept d&#039;un plugin <code class="literal">mysqlnd</code> utilise ces fonctionnalités,
   ainsi que d&#039;autres joyeusetés d&#039;architecture ouverte.
  </p>
  <p class="para">
   <em class="emphasis"> Aucune restriction </em>
  </p>
  <p class="para">
   Un plugin a un accès total aux travaux internes de
   <code class="literal">mysqlnd</code>. Il n&#039;y a aucune limite de sécurité
   ou de restrictions. Tout peut être écrasé pour implémenter des
   algorithmes utiles ou hostiles. Il est recommandé de ne déployer
   que des plugins depuis des sources de confiance.
  </p>
  <p class="para">
   Tel que discuté précédemment, les plugins peuvent utiliser librement
   des pointeurs. Ces pointeurs ne sont restreints en aucune manière,
   aussi, vous pouvez pointer vers les données d&#039;un autre plugin.
   Une simple position arithmétique peut être utilisée pour lire
   les données d&#039;un autre plugin.
  </p>
  <p class="para">
   Il est recommandé d&#039;écrire des plugins coopératifs, et ainsi, appeler
   toujours la méthode parent. Les plugins devraient toujours coopérer avec
   <code class="literal">mysqlnd</code>.
  </p>
  <table class="doctable table">
   <caption><strong>Enjeux : un exemple de chaînage et de coopération</strong></caption>
   
    <thead>
     <tr>
      <th>Extension</th>
      <th>Pointeur mysqlnd.query()</th>
      <th>Pile d&#039;appel si on appelle le parent</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>ext/mysqlnd</td>
      <td>mysqlnd.query()</td>
      <td>mysqlnd.query</td>
     </tr>

     <tr>
      <td>ext/mysqlnd_cache</td>
      <td>mysqlnd_cache.query()</td>
      <td><ol type="1">
       <li class="listitem">
        <p class="para">
         mysqlnd_cache.query()
        </p>
       </li>
       <li class="listitem">
        <p class="para">
         mysqlnd.query
        </p>
       </li>
       </ol></td>
     </tr>

     <tr>
      <td>ext/mysqlnd_monitor</td>
      <td>mysqlnd_monitor.query()</td>
      <td><ol type="1">
       <li class="listitem">
        <p class="para">
         mysqlnd_monitor.query()
        </p>
       </li>
       <li class="listitem">
        <p class="para">
         mysqlnd_cache.query()
        </p>
       </li>
       <li class="listitem">
        <p class="para">
         mysqlnd.query
        </p>
       </li>
       </ol></td>
     </tr>

    </tbody>
   
  </table>

  <p class="para">
   Dans ce scénario, un plugin cache (<code class="literal">ext/mysqlnd_cache</code>) et
   un plugin de surveillance (<code class="literal">ext/mysqlnd_monitor</code>)
   sont chargés. Les 2 ont une sous-classe de <code class="literal">Connection::query()</code>.
   L&#039;enregistrement du plugin survient lors du <code class="literal">MINIT</code>
   en utilisant la logique évoquée précédemment. PHP appelle les extensions
   dans un ordre alphabétique par défaut. Les plugins ne sont pas au courant
   les uns les autres et ne peuvent fixer de dépendances.
  </p>
  <p class="para">
   Par défaut, les plugins appellent l&#039;implémentation du parent de la
   méthode de requête dans leur version de la méthode dérivée.
  </p>
  <p class="para">
   <em class="emphasis"> Récapitulatif de l&#039;extension PHP </em>
  </p>
  <p class="para">
   Voici un récapitulatif de ce qui survient lors de l&#039;utilisation
   d&#039;un plugin d&#039;exemple, <code class="literal">ext/mysqlnd_plugin</code>,
   qui expose l&#039;API C du plugin <code class="literal">mysqlnd</code> à PHP :
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     Toutes les applications PHP MySQL tente d&#039;établir une connexion
     à l&#039;adresse 192.168.2.29
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     L&#039;application PHP utilisera <code class="literal">ext/mysql</code>,
     <code class="literal">ext/mysqli</code> ou <code class="literal">PDO_MYSQL</code>.
     Ces 3 extensions PHP MySQL utilisent <code class="literal">mysqlnd</code> pour
     établir la connexion à l&#039;adresse 192.168.2.29.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">Mysqlnd</code> appelle sa méthode de connexion, qui a été sous-classé
     par <code class="literal">ext/mysqlnd_plugin</code>.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">ext/mysqlnd_plugin</code> appelle la méthode de l&#039;espace utilisateur
     <code class="literal">proxy::connect()</code> enregistrée par l&#039;utilisateur.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     L&#039;espace utilisateur modifie l&#039;hôte de connexion de 192.168.2.29
     à 127.0.0.1 et retourne la connexion établie par
     <code class="literal">parent::connect()</code>.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">ext/mysqlnd_plugin</code> exécute l&#039;équivalent de
     <code class="literal">parent::connect(127.0.0.1)</code> en appelant la méthode
     originale de <code class="literal">mysqlnd</code> pour établir une connexion.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <code class="literal">ext/mysqlnd</code> établit une connexion et redonne la main
     à <code class="literal">ext/mysqlnd_plugin</code>.
     <code class="literal">ext/mysqlnd_plugin</code> retourne également.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Quelque soit l&#039;extension PHP MySQL utilisée par l&#039;application,
     elle reçoit une connexion à 127.0.0.1. L&#039;extension PHP MySQL
     redonne la main à l&#039;application PHP. Le cycle est clos.
    </p>
   </li>
  </ul>
 </div></div></div></body></html>