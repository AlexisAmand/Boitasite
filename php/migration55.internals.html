<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Modifications internes &agrave; PHP</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="migration55.ini.html">« Modification dans la gestion des fichiers INI</a></li>
      <li style="float: right;"><a href="migration54.html">Migration de PHP 5.3.x &agrave; PHP 5.4.x »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="migration55.html">Migration de PHP 5.4.x &agrave; PHP 5.5.x</a></li>
    <li>Modifications internes &agrave; PHP</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="migration55.internals" class="sect1">
  <h2 class="title">Modifications internes à PHP</h2>

  <ul class="itemizedlist">
   <li class="listitem">
    <span class="simpara">
     Les extensions ne peuvent plus surcharger <strong class="command">zend_execute()</strong>
     et devraient désormais surcharger <strong class="command">zend_execute_ex()</strong> à la place.
     <code class="literal">EG(current_execute_data)</code> est déjà initialisé dans
     <strong class="command">zend_execute_ex()</strong>, donc, pour rester compatible, les extensions
     peuvent avoir à utiliser <code class="literal">EG(current_execute_data)-&gt;prev_execute_data</code>
     à la place.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Suppression de <code class="literal">EG(arg_types_stack)</code>,
     <code class="literal">EX(fbc)</code>, <code class="literal">EX(called_scope)</code> et
     <code class="literal">EX(current_object)</code>.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Ajout de <code class="literal">op_array-&gt;nested_calls</code>, qui est calculé
     au moment de la compilation.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Ajout de <code class="literal">EX(call_slots)</code>, qui est un tableau permettant
     de stocker des informations sur les appels imbriqués (i.e.
     <code class="literal">foo(bar())</code>) et est pré-alloué avec
     <code class="literal">execute_data</code>.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Ajout de <code class="literal">EX(call)</code>, qui est un pointeur vers la fonction
     appelante courante, et est un élément de <code class="literal">EX(call_slots)</code>.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Les opcodes
     <a href="internals2.opcodes.init-method-call.html" class="link">INIT_METHOD_CALL</a>,
     <a href="internals2.opcodes.init-static-method-call.html" class="link">ZEND_INIT_STATIC_METHOD_CALL</a>,
     <a href="internals2.opcodes.init-fcall-by-name.html" class="link">ZEND_INIT_FCALL_BY_NAME</a>
     et
     <a href="internals2.opcodes.init-ns-fcall-by-name.html" class="link">ZEND_INIT_NS_FCALL_BY_NAME</a>
     utilisent <code class="literal">result.num</code> comme index dans
     <code class="literal">EX(call_slots)</code>.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     L&#039;opcode <a href="internals2.opcodes.new.html" class="link">ZEND_NEW</a> utilise
     <code class="literal">extended_value</code> comme index dans
     <code class="literal">EX(call_slots)</code>.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Les opcodes <a href="internals2.opcodes.do-fcall.html" class="link">ZEND_DO_FCALL</a>
     et
     <a href="internals2.opcodes.do-fcall-by-name.html" class="link">ZEND_DO_FCALL_BY_NAME</a>
     utilisent <code class="literal">op2.num</code> comme index dans
     <code class="literal">EX(call_slots)</code>.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Ajout de <code class="literal">op_array-&gt;used_stack</code>, qui est calculé lors
     de la compilation ; l&#039;espace de la pile correspondant est pré-alloué avec
     <code class="literal">execute_data</code>. Comme résultat, les opcodes ZEND_SEND* et
     ZEND_DO_FCALL* n&#039;ont plus besoin de vérifier les éventuels dépassements de pile.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Suppression du champ <code class="literal">execute_data-&gt;Ts</code>. Les variables temporaires
     VM sont toujours allouées immédiatement avant la structure
     <code class="literal">execute_data</code>, et sont maintenant accédées par leur
     position depuis le pointeur de base <code class="literal">execute_data</code> au lieu
     d&#039;utiliser <code class="literal">execute_data-&gt;Ts</code>. Le compilateur stocke les
     nouvelles positions dans <code class="literal">op_array-&gt;opcodes[*].op?.num</code>.
     Les macros <strong class="command">EX_TMP_VAR()</strong> et <strong class="command">EX_TMP_VAR_NUM()</strong>
     peuvent être utilisées pour accéder aux variables temporaires par leur position
     ou leur numéro. Vous pouvez convertir le numéro en position en utilisant
     <strong class="command">EX_TMP_VAR_NUM(0,num)</strong> ou la position en numéro en utilisant
     <strong class="command">(EX_TMP_VAR_NUM(0,0)-EX_TMP_VAR(0,offset))</strong>.
    </span>
   </li>
   <li class="listitem">
    <span class="simpara">
     Suppression du champ <code class="literal">execute_data-&gt;CVs</code>.
     Les variables VM compilées sont toujours allouées immédiatement
     après la structure <code class="literal">execute_data</code>, et sont désormais
     accédées par leur position depuis le pointeur de base
     <code class="literal">execute_data</code> au lieu d&#039;utiliser
     <code class="literal">execute_data-&gt;CVs</code>. Vous pouvez utiliser la macro
     <strong class="command">EX_CV_NUM()</strong> pour accéder aux variables compilées par leur
     numéro.
    </span>
   </li>
  </ul>
 </div></div></div></body></html>