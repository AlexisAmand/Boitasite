<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Installation</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="oci8.requirements.html">« Pr&eacute;-requis</a></li>
      <li style="float: right;"><a href="oci8.test.html">Test »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="oci8.setup.html">Installation/Configuration</a></li>
    <li>Installation</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="oci8.installation" class="section">
 <h2 class="title">Installation</h2> 
 
 <div class="section" id="oci8.configure">
  <h2 class="title">Configuration de PHP avec OCI8</h2>
  <p class="para">
   Relisez la section précédente sur les
   <a href="oci8.requirements.html" class="link">Pré-requis</a> avant de configurer OCI8.
  </p>
  <p class="para">
   Pour activer l&#039;extension OCI8, configurez PHP avec l&#039;option
   <strong class="option configure">--with-oci8</strong>.
  </p>
  <p class="para">
   Avant de démarrer le serveur web, OCI8, typiquement, nécessite plusieurs
   variables d&#039;environnement (voir ci-dessous) pour localiser les bibliothèques,
   pour pointer vers des fichiers de configuration, et pour définir quelques
   propriétés basiques comme le jeu de caractères utilisé par les bibliothèques
   OCI8. Les variables doivent être définies <em class="emphasis">avant</em> le démarrage
   d&#039;un quelconque processus PHP.
  </p>
  <p class="para">
   Le binaire PHP doit être lié avec les mêmes (ou plus récentes) versions
   majeures des bibliothèques Oracle pour lesquelles il a été configuré. Par exemple,
   si vous compilez OCI8 avec les bibliothèques Oracle 11.2, alors PHP
   doit aussi être déployé et exécuté avec les bibliothèques Oracle 11.2.
   Les applications PHP peuvent se connecter à d&#039;autres versions de base
   de données Oracle, sachant qu&#039;Oracle contient des compatibilités de versions
   des différents clients - serveurs.
  </p>
 </div>
 <div class="section">
  <h2 class="title">Installation OCI8 comme extension partagée</h2>
  <p class="para">
   L&#039;option de configuration <code class="literal">shared</code> permet de construire
   OCI8 comme bibliothèque partagée qui pourra être chargée dynamiquement
   dans PHP. Le fait de construire une extension partagée permet à OCI8
   d&#039;être mis à jour plus facilement sans pour autant impacter le reste de PHP.
  </p>
  <p class="para">
   Configure OCI8 en utilisant une des options de configuration suivantes :
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <p class="para">
      Si vous utilisez les bibliothèques gratuites
      <a href="http://www.oracle.com/technetwork/database/database-technologies/instant-client/overview/index-4369172.html" class="link external">&raquo;&nbsp;Oracle Instant Client</a>,
      alors vous pouvez faire :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
./configure --with-oci8=shared,instantclient,/path/to/instant/client/lib
</pre></div>
       </div>
      </div>
     </p>
     <p class="para">
      Si le client Oracle Instant est installé depuis des fichiers compressées,
      assurez-vous de créer d&#039;abord le lien symbolique vers la bibliothèque, par exemple,
      <code class="literal">ln -s libclntsh.so.12.1 libclntsh.so</code>.
     </p>
     <p class="para">
      Si vous utilisez une installation du client Oracle Instant à base de
      paquets RPM, la ligne de configuration ressemblera à ceci :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
./configure --with-oci8=shared,instantclient,/usr/lib/oracle/&lt;version&gt;/client/lib
</pre></div>
       </div>
      </div>
     </p>
     <p class="para">
      Par exemple, <strong class="option configure">--with-oci8=shared,instantclient,/usr/lib/oracle/12.1/client/lib</strong>.
     </p>
     <p class="para">
      Notez que le support du client Oracle Instant est apparu pour la première fois
      en PHP 4.3.11 et 5.0.4, et utilisait à l&#039;époque l&#039;option de configuration PHP
      <strong class="option configure">--with-oci8-instant-client</strong>.
     </p>
    </li>
    <li class="listitem">
     <p class="para">
      Si vous utilisez une base de données oracle ou une installation Oracle
      client complète, alors faîtes :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
./configure --with-oci8=shared,$ORACLE_HOME
</pre></div>
       </div>
      </div>
     </p>
     <p class="para">
      Assurez-vous que l&#039;utilisateur du serveur web
      (<code class="literal">nobody</code>, <code class="literal">www</code>) a accès aux bibliothèques,
      aux fichiers d&#039;initialisation, et au fichier <var class="filename">tnsnames.ora</var>
      (si utilisé) dans le dossier <code class="literal">$ORACLE_HOME</code>. Avec Oracle
      10<em class="emphasis">g</em>R2, vous devez avoir besoin d&#039;exécuter l&#039;utilitaire
      <var class="filename">$ORACLE_HOME/install/changePerm.sh</var> pour donner accès
      à ce dossier.
     </p>
    </li>
   </ul>
  </p>
  <p class="para">
   Après la configuration, suivez la procédure de compilation habituelle pour PHP,
   i.e. <em class="emphasis">make install</em>. L&#039;extension partagée OCI8
   <var class="filename">oci8.so</var>sera ainsi créée. Il se peut que vous ayez
   besoin de la déplacer manuellement dans le dossier d&#039;extensions PHP, spécifié
   par l&#039;option <a href="ini.core.html#ini.extension-dir" class="link">extension_dir</a> de votre
   fichier <var class="filename">php.ini</var>.
  </p>
  <p class="para">
   Pour compléter l&#039;installation d&#039;OCI8, éditez votre fichier
   <var class="filename">php.ini</var> et ajoutez-y cette ligne :
  </p>
  <p class="para">
   <div class="informalexample">
    <div class="example-contents screen">
<div class="cdata"><pre>
extension=oci8.so
</pre></div>
    </div>
   </div>
  </p>
 </div>
 <div class="section">
  <h2 class="title">Installation d&#039;OCI8 comme extension compilée statiquement</h2>
  <p class="para">
   Configurez PHP pour inclure OCI8 en utilisant une des options de configuration suivante :
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <p class="para">
      Si vous utilisez le client Oracle Instant, faîtes ceci :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
./configure --with-oci8=instantclient,/path/to/instant/client/lib
</pre></div>
       </div>
      </div>
     </p>
    </li>
    <li class="listitem">
     <p class="para">
      Si vous utilisez une base de données Oracle ou une installation
      client complète d&#039;Oracle, alors faîtes ceci :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
./configure --with-oci8=$ORACLE_HOME
</pre></div>
       </div>
      </div>
     </p>
    </li>
   </ul>
  </p>
  <p class="para">
   Après configuration, suivez la procédure de compilation habituelle de PHP,
   i.e. <em class="emphasis">make install</em>. Après une compilation réussie,
   vous n&#039;avez pas besoin d&#039;ajouter le fichier <var class="filename">oci8.so</var> à
   votre fichier <var class="filename">php.ini</var>. Aucune autre étape
   de compilation n&#039;est nécessaire.
  </p>
 </div>
 <div class="section">
  <h2 class="title">Installation d&#039;OCI8 depuis PECL</h2>
  <p class="para">
   L&#039;extension OCI8 peut être ajoutée à une installation PHP existante
   soit automatiquement, soit manuellement depuis
   <a href="https://pecl.php.net/package/oci8" class="link external">&raquo;&nbsp;PECL</a>.
  </p>
  <p class="para">
   Pour une installation automatique, suivez les étapes suivantes :
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <p class="para">
      Si vous être derrière un part-feu, définissez le proxy PEAR, par exemple :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
pear config-set http_proxy http://my-proxy.example.com:80/
</pre></div>
       </div>
      </div>
     </p>
    </li>
    <li class="listitem">
     <p class="para">
      Exécutez :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
pecl install oci8
</pre></div>
       </div>
      </div>
     </p>
     <p class="para">
      Lorsque vous avez de nouveau la main, entrez soit la valeur de la
      variable <code class="literal">$ORACLE_HOME</code>, soit <code class="literal">instantclient,/path/to/instant/client/lib</code>.
     </p>
     <p class="para">
      Note : N&#039;entrez pas la variable <code class="literal">$ORACLE_HOME</code>
      car elle ne sera pas analysée. A la place, entrez le chemin actuel
      du dossier principal d&#039;Oracle.
     </p>
    </li>
   </ul>
  </p>
  <p class="para">
   Pour une installation manuelle (lorsque la commande <code class="literal">pecl</code>
   n&#039;est pas disponible), téléchargez le paquet PECL OCI8,
   i.e. <var class="filename">oci8-1.4.10.tgz</var>.
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <p class="para">
      Extraire le paquet :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
tar -zxf oci8-1.4.10.tgz
cd oci8-1.4.10
</pre></div>
       </div>
      </div>
     </p>
    </li>
    <li class="listitem">
     <p class="para">
      Préparez le paquet :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
phpize
</pre></div>
       </div>
      </div>
     </p>
    </li>
    <li class="listitem">
     <p class="para">
      Configurez le paquet, soit en utilisant <code class="literal">$ORACLE_HOME</code>,
      soit en utilisant le client Oracle Instant
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
./configure -with-oci8=shared,$ORACLE_HOME
</pre></div>
       </div>
      </div>
     </p>
     <p class="para">
      or
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
./configure -with-oci8=shared,instantclient,/path/to/instant/client/lib
</pre></div>
       </div>
      </div>
     </p>
    </li>
    <li class="listitem">
     <p class="para">
      Installez le paquet :
     </p>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
make install
</pre></div>
       </div>
      </div>
     </p>
    </li>
   </ul>
  </p>
  <p class="para">
   Après une installation automatique ou manuelle, éditez votre fichier
   <var class="filename">php.ini</var> et ajoutez la ligne :
  </p>
  <p class="para">
   <div class="informalexample">
    <div class="example-contents screen">
<div class="cdata"><pre>
extension=oci8.so
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   Assurez-vous que la directive <a href="ini.core.html#ini.extension-dir" class="link">extension_dir</a>
   de votre <var class="filename">php.ini</var> est définie au dossier dans lequel
   <var class="filename">oci8.so</var> a été installé.
  </p>
 </div>
 <div class="section">
  <h2 class="title">Installation d&#039;OCI8 sous Windows</h2>
  <p class="para">
   Lors de l&#039;utilisation des bibliothèques clientes Oracle
   Oracle 10<em class="emphasis">g</em>R2 sous Windows, dé-commentez la ligne
   <code class="literal">extension=php_oci8.dll</code> de votre fichier <var class="filename">php.ini</var>.
   Lors de l&#039;utilisation des bibliothèques clientes Oracle 11<em class="emphasis">g</em>R2
   ou supérieurs, dé-commentez la ligne <code class="literal">extension=php_oci8_11g.dll</code>
   ou la ligne <code class="literal">extension=php_oci8.dll</code>. Avec les bibliothèques clientes
   Oracle 12<em class="emphasis">c</em>, utilisez <code class="literal">extension=php_oci8_12c.dll</code>
   ou <code class="literal">extension=php_oci8_11g.dll</code>, ou bien
   <code class="literal">extension=php_oci8.dll</code>. Seule une de ces DLLs doivt
   être active au même moment. Les DLLs avec des versions supérieures peuvent
   contenir plus de fonctionalités. Toutes les DLLs peuvent ne pas être disponibles
   pour toutes les versions de PHP. Assurez-vous que l&#039;option
   <a href="ini.core.html#ini.extension-dir" class="link">extension_dir</a> est définie sur le dossier
   contenant les extensions DLLs de PHP.
  </p>
  <p class="para">
   Si vous utilisez le client Oracle Instant, définissez la variable
   d&#039;environnement <var class="envar">PATH</var> du système au dossier contenant les
   bibliothèques Oracle.
  </p>
 </div>
 <div class="section">
  <h2 class="title">Définition de l&#039;environnement Oracle</h2>
  <p class="para">
   Avant d&#039;utiliser cette extension, assurez-vous que les variables d&#039;environnement
   Oracle sont correctement définies pour l&#039;utilisateur exécutant le serveur Web.
   Si votre serveur Web est automatiquement démarré au démarrage de votre serveur,
   alors assurez-vous également de la bonne configuration de la variable
   d&#039;environnement utilisé à ce moment ci.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Ne définissez pas les variables d&#039;environnement Oracle en utilisant la fonction
    <span class="function"><a href="function.putenv.html" class="function">putenv()</a></span> dans vos scripts PHP, car les bibliothèques
    Oracle sont chargées et initialisées avant l&#039;exécution de votre script.
    Les variables définies avec <span class="function"><a href="function.putenv.html" class="function">putenv()</a></span> pourraient
    ainsi entrer en conflit et provoquer aussi bien des crashs que des
    comportements totalement inattendu. Des fonctions peuvent réagir
    normalement, d&#039;autres peuvent provoquer des erreurs. Les variables
    doivent être définies <em class="emphasis">avant</em> le démarrage du
    serveur.  
   </p>
  </p></blockquote>
  <p class="para">
   Sous les systèmes Red Hat Linux et ces variantes, vous devez exporter
   les variables à la fin du fichier <var class="filename">/etc/sysconfig/httpd</var>.
   Sous les autres systèmes utilisant Apache 2, vous devez utiliser le
   script <var class="filename">envvars</var> que vous trouverez dans le dossier
   <var class="filename">bin</var> d&#039;Apache. Une autre option consiste à utiliser
   la directive <code class="literal">SetEnv</code> du fichier
   <var class="filename">httpd.conf</var>, mais ceci peut ne pas être suffisant
   sur quelques systèmes.
  </p>
  <p class="para">
   Pour vérifier si les variables d&#039;environnement ont été définies
   correctement, utilisez la fonction <span class="function"><a href="function.phpinfo.html" class="function">phpinfo()</a></span>
   et attardez-vous sur la section <em class="emphasis">Environment</em>
   (et non la section <em class="emphasis">Apache Environment</em>) ;
   elle doit contenir toutes les variables définies.
  </p>
  <p class="para">
   Les variables qui doivent vous êtes nécessaires sont
   inclues dans la table suivante. Reportez-vous à la documentation Oracle
   pour plus d&#039;informations sur toutes les variables.
   <table class="doctable table">
    <caption><strong>Variables d&#039;environnement Oracle communes</strong></caption>
    
     <thead>
      <tr>
       <th>Nom</th>
       <th>But</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>ORACLE_HOME</td>
       <td>
        Chemin vers le dossier contenant le logiciel de base de données
        Oracle. Ne définissez pas cette variable si vous utilisez le client
        Oracle Instant. En effet, elle n&#039;est pas nécessaire mais peu causer
        des problèmes lors de l&#039;installation.
       </td>
      </tr>

      <tr>
       <td>ORACLE_SID</td>
       <td>
        Le nom de la base de données sur la machine locale. Il n&#039;est pas
        nécessaire de la définir si vous utilisez le client Oracle Instant,
        ou alors, passez la toujours comme paramètre de connexion à la
        fonction <span class="function"><a href="function.oci-connect.html" class="function">oci_connect()</a></span>.</td>
      </tr>

      <tr>
       <td>LD_LIBRARY_PATH</td>
       <td>
        Définissez cette variable (ou son équivalent sur la plateforme
        courante, comme <code class="literal">DYLD_LIBRARY_PATH</code>,
        <code class="literal">LIBPATH</code>, ou <code class="literal">SHLIB_PATH</code>)
        comme le chemin vers les bibliothèques Oracle, par exemple
        <var class="filename">$ORACLE_HOME/lib</var> ou
        <var class="filename">/usr/lib/oracle/11.1/client/lib</var>.
        Cette variable n&#039;est pas nécessaire si les bibliothèques
        sont localisées par un mécanisme de recherche différent, comme
        avec <var class="filename">ldconfig</var> ou
        avec <code class="literal">LD_PRELOAD</code>.
       </td>
      </tr>

      <tr>
       <td>NLS_LANG</td>
       <td>
        C&#039;est la variable principale pour définir le
        jeu de caractères et les informations de globalisation
        utilisés par les bibliothèques Oracle.
       </td>
      </tr>

      <tr>
       <td>ORA_SDTZ</td>
       <td>
        Définit le décalage horaire à utiliser par les sessions Oracle.
       </td>
      </tr>

      <tr>
       <td>TNS_ADMIN</td>
       <td>
        Chemin vers le dossier contenant les fichiers de configuration
        Oracle Net Services (<var class="filename">tnsnames.ora</var>
        et <var class="filename">sqlnet.ora</var>). Inutile si la chaîne
        de connexion utilisée par la fonction
        <span class="function"><a href="function.oci-connect.html" class="function">oci_connect()</a></span> est au format de connexion facile
        comme <code class="literal">localhost/XE</code>. Inutile également si les
        fichiers de configuration du réseau sont à des endroits
        par défaut comme <var class="filename">$ORACLE_HOME/network/admin</var>
        ou <var class="filename">/etc</var>.
       </td>
      </tr>

     </tbody>
    
   </table>

   Il existe d&#039;autres variables d&#039;environnement Oracle moins souvent
   utilisées, comme <code class="literal">TWO_TASK</code>,
   <code class="literal">ORA_TZFILE</code>, ainsi que les diverses variables
   de globalisation comme <code class="literal">NLS*</code> et
   <code class="literal">ORA_NLS_*</code>.
  </p>
 </div>
 <div class="section">
  <h2 class="title">En cas de problème</h2>
  <p class="para">
   Le problème le plus courant lors de l&#039;installation d&#039;OCI8 est
   d&#039;avoir mal configuré le jeu de variables d&#039;environnement correctement.
   C&#039;est un problème typique lorsque vous recevez un message
   d&#039;erreur lors de l&#039;utilisation des fonctions
   <span class="function"><a href="function.oci-connect.html" class="function">oci_connect()</a></span> ou <span class="function"><a href="function.oci-pconnect.html" class="function">oci_pconnect()</a></span>.
   L&#039;erreur peut être une erreur purement PHP comme <em class="emphasis">Call to undefined function
   oci_connect()</em>, une erreur Oracle comme ORA-12705 ou
   encore un arrêt brutal d&#039;Apache. Vérifiez le contenu des fichiers de
   log d&#039;Apache lors de son démarrage et reportez-vous aux sections
   ci-dessus pour résoudre le problème.
  </p>
  <p class="para">
   Alors que les erreurs réseaux comme ORA-12154 ou ORA-12514 indiquent
   un problème quant au nommage du réseau ou un problème de configuration,
   bien souvent, la cause première est que l&#039;environnement PHP n&#039;est pas
   correctement défini et que les bibliothèques Oracle sont incapables
   de trouver le fichier de configuration <var class="filename">tnsnames.ora</var>.
  </p>
  <p class="para">
   Sous Windows, le fait d&#039;avoir plusieurs versions d&#039;Oracle sur la même
   machine peut facilement faire crasher l&#039;installation tant que vous
   ne vous êtes pas assuré que PHP n&#039;utilise pas uniquement la bonne
   version d&#039;Oracle.
  </p>
  <p class="para">
   Un utilitaire permettent d&#039;examiner les bibliothèques recherchées
   et chargées peut vous aider quant à la résolution de ce genre
   de problème, tout particulièrement sous Windows.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>Si le serveur Web ne démarre pas ou échoue au démarrage</strong><br />
   <p class="para">
    Vérifiez qu&#039;Apache est lié avec la bibliothèque pthread :
   </p>
   <p class="para">
    <div class="informalexample">
     <div class="example-contents screen">
<div class="cdata"><pre>
# ldd /www/apache/bin/httpd
  libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x4001c000)
  libm.so.6 =&gt; /lib/libm.so.6 (0x4002f000)
  libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x4004c000)
  libdl.so.2 =&gt; /lib/libdl.so.2 (0x4007a000)
  libc.so.6 =&gt; /lib/libc.so.6 (0x4007e000)
  /lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x40000000)
</pre></div>
     </div>
    </div>
   </p>
   <p class="para">
    Si la bibliothèque libpthread n&#039;est pas listé, réinstallez Apache :
   </p>
   <p class="para">
    <div class="informalexample">
     <div class="example-contents screen">
<div class="cdata"><pre>
# cd /usr/src/apache_1.3.xx
# make clean
# LIBS=-lpthread ./config.status
# make
# make install
</pre></div>
     </div>
    </div>
   </p>
   <p class="para">
    Notez que sous des systèmes comme UnixWare, la bibliothèque s&#039;appelle
    libthread au lieu de libpthread. PHP et Apache doivent être configurés
    avec EXTRA_LIBS=-lthread.
   </p>
  </p></blockquote>
 </div>
 
 
</div></div></div></body></html>