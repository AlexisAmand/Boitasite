<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Mesure de l'efficacit&eacute; du cache</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqlnd-qc.cache-candidates.html">« Trouver des candidats &agrave; la mise en cache</a></li>
      <li style="float: right;"><a href="mysqlnd-qc.set-user-handlers.html">Au-dela du TTL : gestionnaire de stockage d&eacute;fini par l'utilisateur »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqlnd-qc.quickstart.html">D&eacute;marrage rapide et quelques exemples</a></li>
    <li>Mesure de l'efficacit&eacute; du cache</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqlnd-qc.cache-efficiency" class="section">
  <h2 class="title">Mesure de l&#039;efficacité du cache</h2>
  <p class="para">
   PECL/mysqlnd_qc fournit 3 façons de mesurer l&#039;efficacité du
   cache. La fonction
   <span class="function"><a href="function.mysqlnd-qc-get-normalized-query-trace-log.html" class="function">mysqlnd_qc_get_normalized_query_trace_log()</a></span>
   retourne des statistiques aggrégées par la normalisation
   d&#039;une chaîne de requête, la fonction
   <span class="function"><a href="function.mysqlnd-qc-get-cache-info.html" class="function">mysqlnd_qc_get_cache_info()</a></span> fournit des informations
   spécifiques au gestionnaire de stockage qui incluent une liste de
   tous les éléments mis en cache, suivant le gestionnaire de stockage.
   De plus, le cooeur de PECL/mysqlnd_qc collecte un résumé haut niveau
   des statistiques aggrégées par processus PHP. Les statistiques
   haut niveau sont retournées par la fonction
   <span class="function"><a href="function.mysqlnd-qc-get-core-stats.html" class="function">mysqlnd_qc_get_core_stats()</a></span>.
  </p>
  <p class="para">
   Les fonctions <span class="function"><a href="function.mysqlnd-qc-get-normalized-query-trace-log.html" class="function">mysqlnd_qc_get_normalized_query_trace_log()</a></span>
   et <span class="function"><a href="function.mysqlnd-qc-get-core-stats.html" class="function">mysqlnd_qc_get_core_stats()</a></span> ne collecteront pas
   de données tant que leurs directives de configuration PHP correspondantes
   ne sont pas activées. Veuillez vous reporter aux différents exemples
   pour récupérer les noms de ces directives de configuration. La collecte
   de données est désactivée par défaut et ce, en raison des impacts
   sur la performances. Elle est configurable via la directive de
   configuration <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.time-statistics" class="link">
   <code class="literal">mysqlnd_qc.time_statistics</code></a>. La collecte
   de statistiques quant au durée est activée par défaut mais uniquement
   effectuée si la collecte de données a été activée.
   Le fait d&#039;enregistrer des statistiques quant au durée cause
   beaucoup d&#039;appels système. Dans la plupart des cas, le bénéfice
   d&#039;une surveillance l&#039;emporte sur la perte de performance dûe
   aux appels système additionnelles.
  </p>
  <p class="para">
   <div class="example" id="example-2272">
    <p><strong>Exemple #1 Collecte de données statistiques avec 
     la configuration ini <code class="literal">mysqlnd_qc.time_statistics</code></strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_qc.enable_qc=1
mysqlnd_qc.collect_statistics=1</pre>
</div>
    </div>

    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;connexion&nbsp;à&nbsp;MySQL&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"host"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"schema"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"port"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"socket"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1),&nbsp;(2),&nbsp;(3)"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;quelques&nbsp;requêtes&nbsp;*/<br /></span><span style="color: #007700">for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;=&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"/*%s*/SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;%d"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MYSQLND_QC_ENABLE_SWITCH</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">%&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_qc_get_core_stats</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>Les exemples ci-dessus vont afficher :</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(26) {
  [&quot;cache_hit&quot;]=&gt;
  string(1) &quot;2&quot;
  [&quot;cache_miss&quot;]=&gt;
  string(1) &quot;2&quot;
  [&quot;cache_put&quot;]=&gt;
  string(1) &quot;2&quot;
  [&quot;query_should_cache&quot;]=&gt;
  string(1) &quot;4&quot;
  [&quot;query_should_not_cache&quot;]=&gt;
  string(1) &quot;3&quot;
  [&quot;query_not_cached&quot;]=&gt;
  string(1) &quot;3&quot;
  [&quot;query_could_cache&quot;]=&gt;
  string(1) &quot;4&quot;
  [&quot;query_found_in_cache&quot;]=&gt;
  string(1) &quot;2&quot;
  [&quot;query_uncached_other&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;query_uncached_no_table&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;query_uncached_no_result&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;query_uncached_use_result&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;query_aggr_run_time_cache_hit&quot;]=&gt;
  string(2) &quot;28&quot;
  [&quot;query_aggr_run_time_cache_put&quot;]=&gt;
  string(3) &quot;900&quot;
  [&quot;query_aggr_run_time_total&quot;]=&gt;
  string(3) &quot;928&quot;
  [&quot;query_aggr_store_time_cache_hit&quot;]=&gt;
  string(2) &quot;14&quot;
  [&quot;query_aggr_store_time_cache_put&quot;]=&gt;
  string(2) &quot;40&quot;
  [&quot;query_aggr_store_time_total&quot;]=&gt;
  string(2) &quot;54&quot;
  [&quot;receive_bytes_recorded&quot;]=&gt;
  string(3) &quot;136&quot;
  [&quot;receive_bytes_replayed&quot;]=&gt;
  string(3) &quot;136&quot;
  [&quot;send_bytes_recorded&quot;]=&gt;
  string(2) &quot;84&quot;
  [&quot;send_bytes_replayed&quot;]=&gt;
  string(2) &quot;84&quot;
  [&quot;slam_stale_refresh&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;slam_stale_hit&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;request_counter&quot;]=&gt;
  int(1)
  [&quot;process_hash&quot;]=&gt;
  int(1929695233)
}
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   Pour une vue rapide, appelez la fonction
   <span class="function"><a href="function.mysqlnd-qc-get-core-stats.html" class="function">mysqlnd_qc_get_core_stats()</a></span>. Elle délivre l&#039;utilisation
   du cache, les durées du cache, ainsi que les statistiques relatives au trafic.
   Les valeurs sont aggrégées pour chaque processus pour toutes les requêtes
   émises par n&#039;importe quel appel API à PHP MySQL.
  </p>
  <p class="para">
   Quelques gestionnaires de stockage, comme le gestionnaire par défaut, peuvent
   signaler les entrées du cache, les statistiques relatives aux entrées et aux méta-données
   pour la requête sous-jacente via la fonction
   <span class="function"><a href="function.mysqlnd-qc-get-cache-info.html" class="function">mysqlnd_qc_get_cache_info()</a></span>. Notez que les informations
   retournées dépendant du gestionnaire de stockage. Les valeurs sont aggrégées pour
   chaque processus.
  </p>
  <p class="para">
   <div class="example" id="example-2273">
    <p><strong>Exemple #2 Exemple avec <span class="function"><a href="function.mysqlnd-qc-get-cache-info.html" class="function">mysqlnd_qc_get_cache_info()</a></span></strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_qc.enable_qc=1</pre>
</div>
    </div>

    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;connexion&nbsp;à&nbsp;MySQL&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"host"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"schema"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"port"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"socket"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1),&nbsp;(2),&nbsp;(3)"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;quelques&nbsp;requêtes&nbsp;pour&nbsp;remplir&nbsp;les&nbsp;traces&nbsp;*/<br /></span><span style="color: #007700">for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;=&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"/*%s*/SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;%d"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MYSQLND_QC_ENABLE_SWITCH</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">%&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br />}<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_qc_get_cache_info</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>Les exemples ci-dessus vont afficher :</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(4) {
  [&quot;num_entries&quot;]=&gt;
  int(2)
  [&quot;handler&quot;]=&gt;
  string(7) &quot;default&quot;
  [&quot;handler_version&quot;]=&gt;
  string(5) &quot;1.0.0&quot;
  [&quot;data&quot;]=&gt;
  array(2) {
    [&quot;Localhost via UNIX socket
3306
root
test|/*qc=on*/SELECT id FROM test WHERE id = 1&quot;]=&gt;
    array(2) {
      [&quot;statistics&quot;]=&gt;
      array(11) {
        [&quot;rows&quot;]=&gt;
        int(1)
        [&quot;stored_size&quot;]=&gt;
        int(71)
        [&quot;cache_hits&quot;]=&gt;
        int(1)
        [&quot;run_time&quot;]=&gt;
        int(391)
        [&quot;store_time&quot;]=&gt;
        int(27)
        [&quot;min_run_time&quot;]=&gt;
        int(16)
        [&quot;max_run_time&quot;]=&gt;
        int(16)
        [&quot;min_store_time&quot;]=&gt;
        int(8)
        [&quot;max_store_time&quot;]=&gt;
        int(8)
        [&quot;avg_run_time&quot;]=&gt;
        int(8)
        [&quot;avg_store_time&quot;]=&gt;
        int(4)
      }
      [&quot;metadata&quot;]=&gt;
      array(1) {
        [0]=&gt;
        array(8) {
          [&quot;name&quot;]=&gt;
          string(2) &quot;id&quot;
          [&quot;orig_name&quot;]=&gt;
          string(2) &quot;id&quot;
          [&quot;table&quot;]=&gt;
          string(4) &quot;test&quot;
          [&quot;orig_table&quot;]=&gt;
          string(4) &quot;test&quot;
          [&quot;db&quot;]=&gt;
          string(4) &quot;test&quot;
          [&quot;max_length&quot;]=&gt;
          int(1)
          [&quot;length&quot;]=&gt;
          int(11)
          [&quot;type&quot;]=&gt;
          int(3)
        }
      }
    }
    [&quot;Localhost via UNIX socket
3306
root
test|/*qc=on*/SELECT id FROM test WHERE id = 0&quot;]=&gt;
    array(2) {
      [&quot;statistics&quot;]=&gt;
      array(11) {
        [&quot;rows&quot;]=&gt;
        int(0)
        [&quot;stored_size&quot;]=&gt;
        int(65)
        [&quot;cache_hits&quot;]=&gt;
        int(1)
        [&quot;run_time&quot;]=&gt;
        int(299)
        [&quot;store_time&quot;]=&gt;
        int(13)
        [&quot;min_run_time&quot;]=&gt;
        int(11)
        [&quot;max_run_time&quot;]=&gt;
        int(11)
        [&quot;min_store_time&quot;]=&gt;
        int(6)
        [&quot;max_store_time&quot;]=&gt;
        int(6)
        [&quot;avg_run_time&quot;]=&gt;
        int(5)
        [&quot;avg_store_time&quot;]=&gt;
        int(3)
      }
      [&quot;metadata&quot;]=&gt;
      array(1) {
        [0]=&gt;
        array(8) {
          [&quot;name&quot;]=&gt;
          string(2) &quot;id&quot;
          [&quot;orig_name&quot;]=&gt;
          string(2) &quot;id&quot;
          [&quot;table&quot;]=&gt;
          string(4) &quot;test&quot;
          [&quot;orig_table&quot;]=&gt;
          string(4) &quot;test&quot;
          [&quot;db&quot;]=&gt;
          string(4) &quot;test&quot;
          [&quot;max_length&quot;]=&gt;
          int(0)
          [&quot;length&quot;]=&gt;
          int(11)
          [&quot;type&quot;]=&gt;
          int(3)
        }
      }
    }
  }
}
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   Il est possible de décomposer davantage le niveau de granularité des statistiques
   au niveau de la chaîne de requête normalisée. La chaîne de requête
   normalisée correspond à la chaîne de requête avec tous les paramètres
   remplacés avec les marqueurs. Par exemple, les deux requêtes
   <code class="literal">SELECT id FROM test WHERE id = 0</code> et
   <code class="literal">SELECT id FROM test WHERE id = 1</code> sont normalisées
   en <code class="literal">SELECT id FROM test WHERE id = ?</code>. Les statistiques
   pour ces deux requêtes sont aggrégées en une seule entrée pour
   <code class="literal">SELECT id FROM test WHERE id = ?</code>.
  </p>
  <p class="para">
   <div class="example" id="example-2274">
    <p><strong>Exemple #3 Exemple avec <span class="function"><a href="function.mysqlnd-qc-get-normalized-query-trace-log.html" class="function">mysqlnd_qc_get_normalized_query_trace_log()</a></span></strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_qc.enable_qc=1
mysqlnd_qc.collect_normalized_query_trace=1</pre>
</div>
    </div>

    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;connexion&nbsp;à&nbsp;MySQL&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"host"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"schema"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"port"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"socket"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1),&nbsp;(2),&nbsp;(3)"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;quelques&nbsp;requêtes&nbsp;pour&nbsp;remplir&nbsp;les&nbsp;traces&nbsp;*/<br /></span><span style="color: #007700">for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;=&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"/*%s*/SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;%d"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MYSQLND_QC_ENABLE_SWITCH</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">%&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br />}<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_qc_get_normalized_query_trace_log</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>Les exemples ci-dessus vont afficher :</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(4) {
  [0]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(25) &quot;DROP TABLE IF EXISTS test&quot;
    [&quot;occurences&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;avg_run_time&quot;]=&gt;
    int(0)
    [&quot;min_run_time&quot;]=&gt;
    int(0)
    [&quot;max_run_time&quot;]=&gt;
    int(0)
    [&quot;avg_store_time&quot;]=&gt;
    int(0)
    [&quot;min_store_time&quot;]=&gt;
    int(0)
    [&quot;max_store_time&quot;]=&gt;
    int(0)
  }
  [1]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(27) &quot;CREATE TABLE test (id INT )&quot;
    [&quot;occurences&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;avg_run_time&quot;]=&gt;
    int(0)
    [&quot;min_run_time&quot;]=&gt;
    int(0)
    [&quot;max_run_time&quot;]=&gt;
    int(0)
    [&quot;avg_store_time&quot;]=&gt;
    int(0)
    [&quot;min_store_time&quot;]=&gt;
    int(0)
    [&quot;max_store_time&quot;]=&gt;
    int(0)
  }
  [2]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(46) &quot;INSERT INTO test (id ) VALUES (? ), (? ), (? )&quot;
    [&quot;occurences&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;avg_run_time&quot;]=&gt;
    int(0)
    [&quot;min_run_time&quot;]=&gt;
    int(0)
    [&quot;max_run_time&quot;]=&gt;
    int(0)
    [&quot;avg_store_time&quot;]=&gt;
    int(0)
    [&quot;min_store_time&quot;]=&gt;
    int(0)
    [&quot;max_store_time&quot;]=&gt;
    int(0)
  }
  [3]=&gt;
  array(9) {
    [&quot;query&quot;]=&gt;
    string(31) &quot;SELECT id FROM test WHERE id =?&quot;
    [&quot;occurences&quot;]=&gt;
    int(4)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(true)
    [&quot;avg_run_time&quot;]=&gt;
    int(179)
    [&quot;min_run_time&quot;]=&gt;
    int(11)
    [&quot;max_run_time&quot;]=&gt;
    int(393)
    [&quot;avg_store_time&quot;]=&gt;
    int(12)
    [&quot;min_store_time&quot;]=&gt;
    int(7)
    [&quot;max_store_time&quot;]=&gt;
    int(25)
  }
}
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   Les sources de la distribution de PECL/mysqlnd_qc contiennent un
   dossier <code class="literal">web/</code> dans lequel se trouve un script
   fournissant un exemple de surveillance du cache. Veuillez suivre les
   instructions se trouvant dans cette source.
  </p>
  <p class="para">
   Depuis PECL/mysqlnd_qc 1.1.0, il est possible d&#039;écrire les statistiques
   dans un fichier de log. Voir la directive de configuration
   log file. Please, see <code class="literal"><a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.collect-statistics-log-file" class="link">
   mysqlnd_qc.collect_statistics_log_file</a></code> pour plus d&#039;informations.
  </p>
 </div></div></div></body></html>