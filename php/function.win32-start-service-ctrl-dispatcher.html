<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Enregistre un script avec SCM, alors il peut &ecirc;tre interpr&eacute;t&eacute; en tant que service avec le nom donn&eacute;</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.win32-set-service-status.html">« win32_set_service_status</a></li>
      <li style="float: right;"><a href="function.win32-start-service.html">win32_start_service »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.win32service.html">Fonctions win32service</a></li>
    <li>Enregistre un script avec SCM, alors il peut &ecirc;tre interpr&eacute;t&eacute; en tant que service avec le nom donn&eacute;</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.win32-start-service-ctrl-dispatcher" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">win32_start_service_ctrl_dispatcher</h1>
  <p class="verinfo">(PECL win32service &gt;=0.1.0)</p><p class="refpurpose"><span class="refname">win32_start_service_ctrl_dispatcher</span> &mdash; <span class="dc-title">Enregistre un script avec SCM, alors il peut être interprété en tant que service avec le nom donné</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.win32-start-service-ctrl-dispatcher-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>win32_start_service_ctrl_dispatcher</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$gracefulMode</code><span class="initializer"> = true</span></span>
  ] ) : <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
   Lorsque exécuté via le Gestionnaire de Contrôle de Service, un processus de
   service est requis pour &quot;archiver&quot; avec lui pour établir un service de
   surveillance et de communication ergonomique. Cette fonction effectue un
   archivage en démarrant un thread pour gérer les communications de bas
   niveau avec le gestionnaire de contrôle de service.
  </p>
  <p class="para">
   Une fois démarré, le processus du service doit faire 2 choses. La première
   est d&#039;indiquer au Service Control Manager que le service est en cours
   d&#039;exécution. La seconde est d&#039;appeler la fonction
   <span class="function"><a href="function.win32-set-service-status.html" class="function">win32_set_service_status()</a></span> avec la constante
   <strong><code>WIN32_SERVICE_RUNNING</code></strong>. Si vous avez besoin de
   lancer des processus longs avant que le service ne soit lancé, alors
   vous pouvez utiliser la constante <strong><code>WIN32_SERVICE_START_PENDING</code></strong>.
   La seconde est de continuer à vérifier en utilisant le Service Control Manager
   sachant qu&#039;il peut déterminer si le service se termine ou non. Ceci consiste
   à appeler, périodiquement, la fonction <span class="function"><a href="function.win32-get-last-control-message.html" class="function">win32_get_last_control_message()</a></span>
   et à traiter le code retourné.
  </p>
  
  <div class="caution"><strong class="caution">Attention</strong>
   <p class="para">
    Depuis la version 0.2.0, cette fonction fonctionne uniquement en ligne de 
    commande. Elle est désactivé dans les autres cas.
   </p>
  </div>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.win32-start-service-ctrl-dispatcher-parameters">
  <h3 class="title">Liste de paramètres</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">name</code></dt>

     <dd>

      <p class="para">
       Le court nom du service, comme enregistré par
       <span class="function"><a href="function.win32-create-service.html" class="function">win32_create_service()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">gracefulMode</code></dt>

     <dd>

      <p class="para">
       <strong><code>TRUE</code></strong> pour la sortie gracieuse. <strong><code>FALSE</code></strong> pour la sortie avec erreur. Voir 
       <span class="function"><a href="function.win32-set-service-exit-mode.html" class="function">win32_set_service_exit_mode()</a></span> pour plus de détails.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.win32-start-service-ctrl-dispatcher-returnvalues">
  <h3 class="title">Valeurs de retour</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success, <strong><code>FALSE</code></strong> if there is a problem with the parameters or a <a href="win32service.constants.errors.html" class="link">Win32 Error Code</a> on failure.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.win32-start-service-ctrl-dispatcher-errors">
  <h3 class="title">Erreurs / Exceptions</h3>
  <p class="para">
   Si cette fonction est utilisé en dehors du SAPI <code class="literal">&quot;cli&quot;</code>, une 
   erreur <strong><code>E_ERROR</code></strong> sera émise.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.win32-start-service-ctrl-dispatcher-examples">
  <h3 class="title">Exemples</h3>
  <p class="para">
   <div class="example" id="example-6018">
    <p><strong>Exemple #1 Exemple avec <span class="function"><strong>win32_start_service_ctrl_dispatcher()</strong></span></strong></p>
    <div class="example-contents"><p>
     Vérifie si le service fonctionne sous SCM.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">win32_start_service_ctrl_dispatcher</span><span style="color: #007700">(</span><span style="color: #DD0000">'dummyphp'</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;die(</span><span style="color: #DD0000">"Je&nbsp;ne&nbsp;fonctionne&nbsp;probablement&nbsp;pas&nbsp;sous&nbsp;le&nbsp;gestionnaire&nbsp;de&nbsp;contrôle&nbsp;de&nbsp;service"</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">win32_set_service_status</span><span style="color: #007700">(</span><span style="color: #0000BB">WIN32_SERVICE_START_PENDING</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Quelques&nbsp;processus&nbsp;longs&nbsp;à&nbsp;récupérer&nbsp;pendant&nbsp;que&nbsp;le&nbsp;service&nbsp;fonctionne.<br /><br /></span><span style="color: #0000BB">win32_set_service_status</span><span style="color: #007700">(</span><span style="color: #0000BB">WIN32_SERVICE_RUNNING</span><span style="color: #007700">);<br /><br /><br />while&nbsp;(</span><span style="color: #0000BB">WIN32_SERVICE_CONTROL_STOP&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">win32_get_last_control_message</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;effectuer&nbsp;votre&nbsp;travail&nbsp;ici.<br />&nbsp;&nbsp;#&nbsp;essayez&nbsp;de&nbsp;ne&nbsp;pas&nbsp;prendre&nbsp;plus&nbsp;de&nbsp;30&nbsp;secondes&nbsp;avant&nbsp;de&nbsp;retourner&nbsp;au<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.win32-start-service-ctrl-dispatcher-changelog">
  <h3 class="title">Historique</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>0.4.0</td>
       <td>
        Le paramètre <code class="parameter">gracefulMode</code> a été ajouté.
       </td>
      </tr>

      <tr>
       <td>0.2.0</td>
       <td>
        Cette fonction fonctionne uniquement en ligne de 
        commande.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.win32-start-service-ctrl-dispatcher-seealso">
  <h3 class="title">Voir aussi</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.win32-set-service-status.html" class="function" rel="rdfs-seeAlso">win32_set_service_status()</a> - Met &agrave; jour le statut d'un service</span></li>
    <li class="member"><span class="function"><a href="function.win32-get-last-control-message.html" class="function" rel="rdfs-seeAlso">win32_get_last_control_message()</a> - Retourne le dernier message de contr&ocirc;le qui a &eacute;t&eacute; envoy&eacute; &agrave; ce service</span></li>
    <li class="member"><span class="function"><a href="function.win32-set-service-exit-mode.html" class="function" rel="rdfs-seeAlso">win32_set_service_exit_mode()</a> - D&eacute;finir ou renvoyer le mode de sortie pour le service en cours d'ex&eacute;cution</span></li>
    <li class="member"><span class="function"><a href="function.win32-set-service-exit-code.html" class="function" rel="rdfs-seeAlso">win32_set_service_exit_code()</a> - D&eacute;finir ou renvoyer le code de sortie pour le service en cours d'ex&eacute;cution</span></li>
    <li class="member">Les <a href="win32service.constants.errors.html" class="link">codes erreur Win32</a></li>
   </ul>
  </p>
 </div>


</div></div></div></body></html>