<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>S&eacute;paration des lectures et &eacute;critures</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqlnd-ms.loadbalancing.html">« R&eacute;partition de charge</a></li>
      <li style="float: right;"><a href="mysqlnd-ms.filter.html">Les filtres »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqlnd-ms.concepts.html">Concepts</a></li>
    <li>S&eacute;paration des lectures et &eacute;critures</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqlnd-ms.rwsplit" class="section">
  <h2 class="title">Séparation des lectures et écritures</h2>
  <p class="para">
   Le plugin envoie les requêtes de type lecture seule sur un des esclaves de réplication
   configurés, et les autres requêtes sur le maitre. Les requêtes sont considérées de type
   lecture seule si elles commencent par <code class="literal">SELECT</code>, si elles comportent
   l&#039;astuce SQL <code class="literal">/*ms=slave*/</code> ou si un esclave a été choisi lors de la
   dernière requête et que l&#039;astuce SQL <code class="literal">/*ms=last_used*/</code> est employée.
   Dans tous les autres cas, la requête sera aiguillée vers le serveur maitre. Il est
   recommandé d&#039;utiliser les constantes <strong><code>MYSQLND_MS_SLAVE_SWITCH</code></strong>,
   <strong><code>MYSQLND_MS_MASTER_SWITCH</code></strong> et <strong><code>MYSQLND_MS_LAST_USED_SWITCH</code></strong>
   au lieu de <code class="literal">/*ms=slave*/</code>. Reportez-vous à
   <a href="mysqlnd-ms.constants.html" class="link">la liste des constantes mysqlnd_ms</a>.
  </p>  
  <p class="para">
   Les astuces SQL représentent des commentaires SQL spéciaux. Le plugin vérifie toutes les
   requêtes à la recherche de telles astuces. Les astuces SQL sont décrites dans les
   <a href="mysqlnd-ms.constants.html" class="link">constantes mysqlnd_ms</a> exportées par l&#039;extension. Les
   autres organes éventuellement présents dans le mécanisme de réplication (serveur MySQL,
   firewalls SQL ou proxies SQL) ne sont pas affectés par les astuces SQL car ils sont sensés
   ignorer les commentaires SQL.
  </p>
  <p class="para">
   L&#039;implémentation interne du séparateur de requêtes lecture/écriture peut être remplacée
   par un filtre utilisateur, voyez le filtre
   <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.filter-user" class="link"><code class="literal">user</code></a>.
  </p>
  <p class="para">
   Une implémentation personnalisée du séparateur de requêtes lecture/écriture peut demander
   au plugin où envoyer la requête, en appelant <span class="function"><strong>mysqlnd_ms_is_select()</strong></span>.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Le séparateur de requêtes lecture/écriture interne ne gère pas les requêtes multiples qui
    sont vues comme une seule requête. Le séparateur va vérifier le début de la requête pour savoir
    vers quel serveur l&#039;envoyer. Si, par exemple, une requête multiple commence par
    <code class="literal">SELECT 1 FROM DUAL; INSERT INTO test(id) VALUES (1); ...</code>
    le plugin l&#039;enverra vers un esclave, alors que cette requête n&#039;est pas de type lecture seule.
   </p>
  </p></blockquote> 
 </div></div></div></body></html>