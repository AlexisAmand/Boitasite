<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Retourne une trace pour chaque requ&ecirc;te inspect&eacute;e par la mise en cache de requ&ecirc;tes</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysqlnd-qc-get-normalized-query-trace-log.html">« mysqlnd_qc_get_normalized_query_trace_log</a></li>
      <li style="float: right;"><a href="function.mysqlnd-qc-set-cache-condition.html">mysqlnd_qc_set_cache_condition »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysqlnd-qc.html">Fonctions mysqlnd_qc</a></li>
    <li>Retourne une trace pour chaque requ&ecirc;te inspect&eacute;e par la mise en cache de requ&ecirc;tes</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysqlnd-qc-get-query-trace-log" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqlnd_qc_get_query_trace_log</h1>
  <p class="verinfo">(PECL mysqlnd_qc &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">mysqlnd_qc_get_query_trace_log</span> &mdash; <span class="dc-title">Retourne une trace pour chaque requête inspectée par la mise en cache de requêtes</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.mysqlnd-qc-get-query-trace-log-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   
   <span class="methodname"><strong>mysqlnd_qc_get_query_trace_log</strong></span>
    ( <span class="methodparam">void</span>
   ) : <span class="type">array</span></div>

  <p class="para rdfs-comment">
   Retourne une trace pour chaque requête inspectée par la mise en cache de requêtes.
   La collection de traces est désactivée par défaut. Pour collecter
   des traces, vous devez définir la directive de configuration PHP
   <code class="literal">mysqlnd_qc.collect_query_trace</code> à <code class="literal">1</code>
  </p>
  <p class="para">
   La profondeur maximale des traces est limitée à la profondeur définie
   par la directive de configuration PHP
   <code class="literal">mysqlnd_qc.query_trace_bt_depth</code>.
  </p>
  
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.mysqlnd-qc-get-query-trace-log-parameters">
  <h3 class="title">Liste de paramètres</h3>
  <p class="para">Cette fonction ne contient aucun paramètre.</p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.mysqlnd-qc-get-query-trace-log-returnvalues">
  <h3 class="title">Valeurs de retour</h3>
  <p class="para">
   Un tableau de traces des requêtes. Chaque entrée de la liste
   contient la chaîne de requête, une trace ainsi que quelques
   informations détaillées.
  </p>
  
  <table class="doctable informaltable">
   
    <col width="1*" />
    <col width="9*" />
    <thead>
     <tr>
      <th>Clé</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>
       <code class="literal">query</code>
      </td>
      <td>
       La chaîne représentant la requête.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">origin</code>
      </td>
      <td>
       Le code de la trace.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">run_time</code>
      </td>
      <td>
       Durée d&#039;exécution de la requête, en millisecondes.
       La collection de toutes les durées ainsi que les appels
       nécessaires à la fonction système <code class="literal">gettimeofday</code>
       peuvent être désactivés en définissant la directive de configuration
       PHP <code class="literal">mysqlnd_qc.time_statistics</code> à <code class="literal">0</code>.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">store_time</code>
      </td>
      <td>
       Durée de stockage du jeu de résultats de la requêtes, en millisecondes.
       La collection de toutes les durées ainsi que les appels
       nécessaires à la fonction système <code class="literal">gettimeofday</code>
       peuvent être désactivés en définissant la directive de configuration
       PHP <code class="literal">mysqlnd_qc.time_statistics</code> à <code class="literal">0</code>.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">eligible_for_caching</code>
      </td>
      <td>
       <strong><code>TRUE</code></strong> si la requête est éligible à la mise en cache, <strong><code>FALSE</code></strong> sinon.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">no_table</code>
      </td>
      <td>
       <strong><code>TRUE</code></strong> si la requête a généré un jeu de résultats et au moins, une
       colonne du jeu de résultats n&#039;a pas de nom de table de défini dans
       ces méta-données. C&#039;est généralement le cas avec les requêtes
       qui ne doivent pas être mises en cache, comme
       <code class="literal">SELECT SLEEP(1)</code>. Par défaut, ce genre de requêtes
       ne sera pas ajouté au cache. Voir aussi la directive de configuration
       PHP <code class="literal">mysqlnd_qc.cache_no_table</code>.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">was_added</code>
      </td>
      <td>
       <strong><code>TRUE</code></strong> si le résultat de la requête a été ajouté au cache,
       <strong><code>FALSE</code></strong> sinon.
      </td>
     </tr>

     <tr>
      <td>
       <code class="literal">was_already_in_cache</code>
      </td>
      <td>
       <strong><code>TRUE</code></strong> si le résultat de la requête aurait été mise en cache
       si elle n&#039;y était pas déjà présente, <strong><code>FALSE</code></strong> sinon.
      </td>
     </tr>

     
    </tbody>
   
  </table>

 </div>

 
 
 <div class="refsect1 examples" id="refsect1-function.mysqlnd-qc-get-query-trace-log-examples">
  <h3 class="title">Exemples</h3>
  <div class="example" id="example-2282">
   <p><strong>Exemple #1 Exemple avec  <span class="function"><strong>mysqlnd_qc_get_query_trace_log()</strong></span></strong></p>
   <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_qc.collect_query_trace=1</pre>
</div>
   </div>

   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Connexion,&nbsp;création&nbsp;et&nbsp;population&nbsp;de&nbsp;la&nbsp;table&nbsp;test&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"host"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"schema"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"port"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"socket"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1),&nbsp;(2)"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;non&nbsp;mis&nbsp;en&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;1"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*&nbsp;Mis&nbsp;en&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"/*"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">MYSQLND_QC_ENABLE_SWITCH&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"*/"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;2"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*&nbsp;Récupéré&nbsp;depuis&nbsp;le&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"/*"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">MYSQLND_QC_ENABLE_SWITCH&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"*/"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;2"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_assoc</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_qc_get_query_trace_log</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Les exemples ci-dessus vont afficher :</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
array(1) {
  [&quot;id&quot;]=&gt;
  string(1) &quot;1&quot;
}
array(1) {
  [&quot;id&quot;]=&gt;
  string(1) &quot;2&quot;
}
array(1) {
  [&quot;id&quot;]=&gt;
  string(1) &quot;2&quot;
}
array(6) {
  [0]=&gt;
  array(8) {
    [&quot;query&quot;]=&gt;
    string(25) &quot;DROP TABLE IF EXISTS test&quot;
    [&quot;origin&quot;]=&gt;
    string(102) &quot;#0 qc.php(4): mysqli-&gt;query(&#039;DROP TABLE IF E...&#039;)
#1 {main}&quot;
    [&quot;run_time&quot;]=&gt;
    int(0)
    [&quot;store_time&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;no_table&quot;]=&gt;
    bool(false)
    [&quot;was_added&quot;]=&gt;
    bool(false)
    [&quot;was_already_in_cache&quot;]=&gt;
    bool(false)
  }
  [1]=&gt;
  array(8) {
    [&quot;query&quot;]=&gt;
    string(25) &quot;CREATE TABLE test(id INT)&quot;
    [&quot;origin&quot;]=&gt;
    string(102) &quot;#0 qc.php(5): mysqli-&gt;query(&#039;CREATE TABLE te...&#039;)
#1 {main}&quot;
    [&quot;run_time&quot;]=&gt;
    int(0)
    [&quot;store_time&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;no_table&quot;]=&gt;
    bool(false)
    [&quot;was_added&quot;]=&gt;
    bool(false)
    [&quot;was_already_in_cache&quot;]=&gt;
    bool(false)
  }
  [2]=&gt;
  array(8) {
    [&quot;query&quot;]=&gt;
    string(36) &quot;INSERT INTO test(id) VALUES (1), (2)&quot;
    [&quot;origin&quot;]=&gt;
    string(102) &quot;#0 qc.php(6): mysqli-&gt;query(&#039;INSERT INTO tes...&#039;)
#1 {main}&quot;
    [&quot;run_time&quot;]=&gt;
    int(0)
    [&quot;store_time&quot;]=&gt;
    int(0)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;no_table&quot;]=&gt;
    bool(false)
    [&quot;was_added&quot;]=&gt;
    bool(false)
    [&quot;was_already_in_cache&quot;]=&gt;
    bool(false)
  }
  [3]=&gt;
  array(8) {
    [&quot;query&quot;]=&gt;
    string(32) &quot;SELECT id FROM test WHERE id = 1&quot;
    [&quot;origin&quot;]=&gt;
    string(102) &quot;#0 qc.php(9): mysqli-&gt;query(&#039;SELECT id FROM ...&#039;)
#1 {main}&quot;
    [&quot;run_time&quot;]=&gt;
    int(0)
    [&quot;store_time&quot;]=&gt;
    int(25)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(false)
    [&quot;no_table&quot;]=&gt;
    bool(false)
    [&quot;was_added&quot;]=&gt;
    bool(false)
    [&quot;was_already_in_cache&quot;]=&gt;
    bool(false)
  }
  [4]=&gt;
  array(8) {
    [&quot;query&quot;]=&gt;
    string(41) &quot;/*qc=on*/SELECT id FROM test WHERE id = 2&quot;
    [&quot;origin&quot;]=&gt;
    string(103) &quot;#0 qc.php(14): mysqli-&gt;query(&#039;/*qc=on*/SELECT...&#039;)
#1 {main}&quot;
    [&quot;run_time&quot;]=&gt;
    int(311)
    [&quot;store_time&quot;]=&gt;
    int(13)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(true)
    [&quot;no_table&quot;]=&gt;
    bool(false)
    [&quot;was_added&quot;]=&gt;
    bool(true)
    [&quot;was_already_in_cache&quot;]=&gt;
    bool(false)
  }
  [5]=&gt;
  array(8) {
    [&quot;query&quot;]=&gt;
    string(41) &quot;/*qc=on*/SELECT id FROM test WHERE id = 2&quot;
    [&quot;origin&quot;]=&gt;
    string(103) &quot;#0 qc.php(19): mysqli-&gt;query(&#039;/*qc=on*/SELECT...&#039;)
#1 {main}&quot;
    [&quot;run_time&quot;]=&gt;
    int(13)
    [&quot;store_time&quot;]=&gt;
    int(8)
    [&quot;eligible_for_caching&quot;]=&gt;
    bool(true)
    [&quot;no_table&quot;]=&gt;
    bool(false)
    [&quot;was_added&quot;]=&gt;
    bool(false)
    [&quot;was_already_in_cache&quot;]=&gt;
    bool(true)
  }
}
</pre></div>
   </div>
   
  </div>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.mysqlnd-qc-get-query-trace-log-seealso">
  <h3 class="title">Voir aussi</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member">
     <a href="mysqlnd-qc.configuration.html" class="link">Configuration à l&#039;exécution</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.collect-query-trace" class="link">mysqlnd_qc.collect_query_trace</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.query-trace-bt-depth" class="link">mysqlnd_qc.query_trace_bt_depth</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.time-statistics" class="link">mysqlnd_qc.time_statistics</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.cache-no-table" class="link">mysqlnd_qc.cache_no_table</a>
    </li>
    <li class="member">
     <span class="function"><a href="function.mysqlnd-qc-get-normalized-query-trace-log.html" class="function" rel="rdfs-seeAlso">mysqlnd_qc_get_normalized_query_trace_log()</a> - Retourne une trace dans les logs d'une requ&ecirc;te normalis&eacute;e pour chaque requ&ecirc;te inspect&eacute;e par le cache de requ&ecirc;tes</span>
    </li>
   </ul>
  </p>
 </div>

 
</div></div></div></body></html>