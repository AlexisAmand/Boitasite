<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Configuration</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqlnd-ms.quickstart.html">« Exemples et d&eacute;marrage rapide</a></li>
      <li style="float: right;"><a href="mysqlnd-ms.quickstart.usage.html">Ex&eacute;cuter des requ&ecirc;tes »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqlnd-ms.quickstart.html">Exemples et d&eacute;marrage rapide</a></li>
    <li>Configuration</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqlnd-ms.quickstart.configuration" class="section">
  <h2 class="title">Configuration</h2>
  <p class="para">
   Le plugin est une extension PHP. Veuillez lire
   <a href="mysqlnd-ms.installation.html" class="link">les instructions d&#039;installation</a> pour
   installer l&#039;extension
   <a href="https://pecl.php.net/package/mysqlnd_ms" class="link external">&raquo;&nbsp;PECL/mysqlnd_ms</a>.
  </p>
  <p class="para">
   Configurez une extension PHP pour MySQL (<a href="ref.mysqli.html" class="link">mysqli</a>,
   <a href="ref.pdo-mysql.html" class="link">PDO_MYSQL</a>,
   <a href="ref.mysql.html" class="link">mysql</a>) au choix pour profiter du support
   de <a href="book.mysqlnd.html" class="link">mysqlnd</a>. PECL/mysqlnd_ms
   est un plugin pour mysqlnd. Pour l&#039;utiliser avec une extension PHP pour MySQL,
   celle-ci devra faire usage de mysqlnd.
  </p>
  <p class="para">
   Ensuite, chargez l&#039;extension dans PHP et activez le plugin en utilisant la directive
   de configuration <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.enable" class="link">mysqlnd_ms.enable</a>. 
  </p>
  <p class="para">
   <div class="example" id="example-2156">
    <p><strong>Exemple #1 Activer le plugin (php.ini)</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_ms.enable=1
mysqlnd_ms.config_file=/path/to/mysqlnd_ms_plugin.ini</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   Le plugin utilise son propre fichier de configuration. Utilisez la directive
   <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.config-file" class="link">mysqlnd_ms.config_file</a>
   pour indiquer le chemin complet vers le fichier de configuration du plugin.
   Ce fichier doit être accessible en lecture à PHP (e.g. l&#039;utilisateur
   exécutant le serveur web). Veuillez noter que la directive de configuration
   <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.config-file" class="link">mysqlnd_ms.config_file</a>
   annule et remplace la directive
   <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.ini-file" class="link">mysqlnd_ms.ini_file</a> depuis
   la version 1.4.0. C&#039;est une erreur courante que d&#039;utiliser l&#039;ancienne,
   alors qu&#039;elle n&#039;est plus disponible comme directive de configuration.
  </p>
  <p class="para">
   Créez un fichier de configuration pour le plugin. Indiquez son chemin complet dans
   <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.config-file" class="link">mysqlnd_ms.config_file</a>.
  </p>
  <p class="para">
   Les <a href="mysqlnd-ms.plugin-ini-json.html" class="link">fichiers de configuration</a>
   sont décrits en <acronym title="JavaScript Object Notation">JSON</acronym>. Il existe dedans une ou plusieurs sections.
   Chaque section a un nom, par exemple, <code class="literal">myapp</code>. Chaque section comporte
   ses directives.
  </p>
  <p class="para">
   Une section doit au minimum indiquer le serveur maitre de réplication MySQL
   et une liste d&#039;esclaves. Le plugin ne supporte qu&#039;un seul maitre par section.
   Le multi-maitre n&#039;est pas encore pleinement supporté. Utilisez la directive
   <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.master" class="link">master</a>
   pour indiquer l&#039;hote et le port ou le socket du serveur MySQL maitre.
   Les escalves MySQL sont indiqués via la directive
   <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.slave" class="link">slave</a>.
  </p>
  <p class="para">
   <div class="example" id="example-2157">
    <p><strong>Exemple #2 Configuration minimale du plugin (mysqlnd_ms_plugin.ini)</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: [

        ]
    }
}</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   Une liste d&#039;esclaves MySQL est obligatoire, même si celle-ci est vide.
   Il est recommandé de toujours posséder au moins un esclave.
  </p>
  <p class="para">
   Les listes de serveurs peuvent utiliser <a href="mysqlnd-ms.plugin-ini-json.html#mysqlnd-ms.plugin-ini-json.server-list-syntax" class="link">
   les syntaxes anonyme ou non-anonyme</a>. Les listes non-anonymes incluent un alias
   pour le nom du serveur, comme <code class="literal">master_0</code> pour un maitre.
   Le guide de démarrage rapide utilise la syntaxe non-anonyme.
  </p>
  <p class="para">
   <div class="example" id="example-2158">
    <p><strong>Exemple #3 Configuration minimale recommandée pour le plugin (mysqlnd_ms_plugin.ini)</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;,
                &quot;socket&quot;: &quot;\/tmp\/mysql.sock&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.2.27&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        }
    }
}</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   S&#039;il existe au moins deux serveurs déclarés en configuration, le plugin peut commencer
   à équilibrer la charge entre les connexions. La bascule entre les connexions n&#039;est
   pas tout le temps transparente et peut générer des problèmes. Voyez les références sur
   <a href="mysqlnd-ms.pooling.html" class="link">les pools de connexions et les bascules</a>,
   <a href="mysqlnd-ms.transaction.html" class="link">la gestion des transactions</a>,
   <a href="mysqlnd-ms.failover.html" class="link">la reprise sur incident</a> 
   <a href="mysqlnd-ms.loadbalancing.html" class="link">l&#039;équilibre de la charge</a> et 
   <a href="mysqlnd-ms.rwsplit.html" class="link">la découpe des lectures-écritures</a> pour les détails.
   Vous pouvez désormais continuer de lire ce guide de démarrage. Les astuces
   et problèmes éventuels du plugin vont être détaillées par la suite.
  </p>
  <p class="para">   
   Il est de la responsabilité de l&#039;application de gérer les éventuels problèmes dûs à
   la bascule entre les connexions. En configurant au moins un maitre et un esclave,
   vous vous assurez que le plugin basculera les connexions, et vous détecterez les
   problèmes plus tôt.
  </p>
  <p class="para">
   Les serveurs maitre et esclave que vous configurez peuvent être la même machine.
   Cela peut aider à détecter les erreurs dûes à la bascule entre les connexions,
   mais pas les erreurs dûes à la latence de la réplication. 
  </p>
  <p class="para">
   <div class="example" id="example-2159">
    <p><strong>Exemple #4 Utiliser un seul serveur comme maitre et esclave (test seulement!)</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;,
                &quot;socket&quot;: &quot;\/tmp\/mysql.sock&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;127.0.0.1&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        }
    }
}</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   Le plugin tente de vous notifier des configurations invalides. Depuis la version 1.5.0,
   il va émettre une alerte lors du démarrage de PHP si le fichier de configuration ne peut
   être lu, s&#039;il est vide, ou si l&#039;analyse JSON échoue. Suivant votre configuration de PHP,
   ces erreurs peuvent apparaître seulement dans des fichiers de log. Une autre validation
   est effectuée lorsqu&#039;une connexion est établie et que le fichier de configuration est
   analysé pour y rechercher des sections valides. Le fait de définir la directive
   <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.force-config-usage" class="link">mysqlnd_ms.force_config_usage</a>
   peut vous aider à déboguer une configuration erronée. Voir aussi les
   <a href="mysqlnd-ms.plugin-ini-json.html#mysqlnd-ms.plugin-ini-json.debug_config" class="link">notes relatives au débogage
    du fichier de configuration</a>.
  </p>
  
 </div></div></div></body></html>