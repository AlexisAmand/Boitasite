<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Installe une fonction de rappel qui d&eacute;cide si une requ&ecirc;te doit &ecirc;tre mise en cache</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysqlnd-qc-set-cache-condition.html">« mysqlnd_qc_set_cache_condition</a></li>
      <li style="float: right;"><a href="function.mysqlnd-qc-set-storage-handler.html">mysqlnd_qc_set_storage_handler »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysqlnd-qc.html">Fonctions mysqlnd_qc</a></li>
    <li>Installe une fonction de rappel qui d&eacute;cide si une requ&ecirc;te doit &ecirc;tre mise en cache</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysqlnd-qc-set-is-select" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqlnd_qc_set_is_select</h1>
  <p class="verinfo">(PECL mysqlnd_qc &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">mysqlnd_qc_set_is_select</span> &mdash; <span class="dc-title">Installe une fonction de rappel qui décide si une requête doit être mise en cache</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.mysqlnd-qc-set-is-select-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   
   <span class="methodname"><strong>mysqlnd_qc_set_is_select</strong></span>
    ( <span class="methodparam">
    <span class="type">string</span>
     <code class="parameter">$callback</code>
   </span>
   ) : <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
   Installe une fonction de rappel qui décide si une requête doit être mise
   en cache.
  </p>
  <p class="para">
   Il y a plusieurs façons de demander à PELC/mysqlnd_qc de mettre en cache
   une requête. Par défaut, PECL/mysqlnd_qc tente de mettre en cache une
   requête si la mise en cache de toutes les requêtes est activée ou si
   la chaîne de requête commence avec une astuce SQL. Le plugin, en interne,
   appèle une fonction nommée <code class="literal">is_select()</code>. Cette fonction
   interne peut être remplacée avec une fonction de rappel définie par l&#039;utilisateur.
   Ainsi, la fonction de rappel définie par l&#039;utilisateur est responsable 
   de décider si le plugin tente une mise en cache ou non de la requête.
   En raison du fait que la fonction interne est remplacée par la fonction
   de rappel, la fonction de rappel a un contrôle total. La fonction de rappel
   est libre d&#039;ignorer la directive de configuration
   <code class="literal">mysqlnd_qc.cache_by_default</code> ainsi que les astuces SQL.
  </p>
  <p class="para">
   La fonction de rappel est invoquée pour chaque requête inspectée
   par le plugin. Elle prend la chaîne de requête comme paramètre.
   La fonction de rappel retourne <strong><code>FALSE</code></strong> si la requête ne doit pas être
   mise en cache. Elle retourne <strong><code>TRUE</code></strong> pour demander au plugin de tenter
   de mettre en cache le jeu de résultats, s&#039;il y en a un.
   Une entrée du cache est ainsi créée en utilisant le TTL par défaut
   défini par la directive de configuration PHP <code class="literal">mysqlnd_qc.ttl</code>.
   Si un TTL différent doit être utilisé, la fonction de rappel doit retourner
   une valeur numérique qui sera utilisée comme TTL.
  </p>
  <p class="para">
   La fonction interne <code class="literal">is_select</code> fait partie de l&#039;interface
   interne de gestion de stockage du cache. Aussi, un gestionnaire de stockage
   défini par l&#039;utilisateur offre les mêmes possibilités.
  </p>
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.mysqlnd-qc-set-is-select-parameters">
  <h3 class="title">Liste de paramètres</h3>
  <p class="para">Cette fonction ne contient aucun paramètre.</p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.mysqlnd-qc-set-is-select-returnvalues">
  <h3 class="title">Valeurs de retour</h3>
  <p class="para">
   Cette fonction retourne <strong><code>TRUE</code></strong> en cas de succès ou <strong><code>FALSE</code></strong> si une erreur survient.
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.mysqlnd-qc-set-is-select-examples">
  <h3 class="title">Exemples</h3>
  <div class="example" id="example-2284">
   <p><strong>Exemple #1 Exemple avec <span class="function"><strong>mysqlnd_qc_set_is_select()</strong></span></strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;fonction&nbsp;de&nbsp;rappel&nbsp;qui&nbsp;va&nbsp;décider&nbsp;si&nbsp;la&nbsp;requête&nbsp;doit&nbsp;être&nbsp;mise&nbsp;en&nbsp;cache&nbsp;ou&nbsp;non&nbsp;*/<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">is_select</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;static&nbsp;</span><span style="color: #0000BB">$patterns&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;true&nbsp;-&nbsp;utilisation&nbsp;de&nbsp;la&nbsp;valeur&nbsp;par&nbsp;défaut&nbsp;depuis&nbsp;mysqlnd_qc.ttl&nbsp;*/<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"@SELECT\s+.*\s+FROM\s+test@ismU"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;3&nbsp;-&nbsp;utilisation&nbsp;d'un&nbsp;TTL&nbsp;=&nbsp;3&nbsp;secondes&nbsp;*/<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"@SELECT\s+.*\s+FROM\s+news@ismU"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">3<br />&nbsp;&nbsp;</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;vérifie&nbsp;si&nbsp;la&nbsp;requête&nbsp;correspond&nbsp;au&nbsp;masque&nbsp;*/<br />&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$patterns&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$pattern&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$ttl</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #0000BB">$pattern</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"is_select(%45s):&nbsp;mise&nbsp;en&nbsp;cache\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$ttl</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"is_select(%45s):&nbsp;pas&nbsp;de&nbsp;mise&nbsp;en&nbsp;cache\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br />&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">mysqlnd_qc_set_is_select</span><span style="color: #007700">(</span><span style="color: #DD0000">"is_select"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;Connexion,&nbsp;création&nbsp;et&nbsp;peuplement&nbsp;de&nbsp;la&nbsp;table&nbsp;test&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"host"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"schema"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1),&nbsp;(2),&nbsp;(3)"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;Mise&nbsp;en&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;1"</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">/*&nbsp;Récupération&nbsp;depuis&nbsp;le&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;1"</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">/*&nbsp;Mise&nbsp;en&nbsp;cache&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Les exemples ci-dessus vont afficher :</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
is_select(                    DROP TABLE IF EXISTS test): pas de mise en cache
is_select(                    CREATE TABLE test(id INT)): pas de mise en cache
is_select(    INSERT INTO test(id) VALUES (1), (2), (3)): pas de mise en cache
is_select(             SELECT id FROM test WHERE id = 1): mise en cache
is_select(             SELECT id FROM test WHERE id = 1): mise en cache
is_select(                           SELECT * FROM test): mise en cache
</pre></div>
   </div>
  </div>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.mysqlnd-qc-set-is-select-seealso">
  <h3 class="title">Voir aussi</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member">
     <a href="mysqlnd-qc.configuration.html" class="link">Configuration de l&#039;exécution</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.ttl" class="link">mysqlnd_qc.ttl</a>
    </li>
    <li class="member">
     <a href="mysqlnd-qc.configuration.html#ini.mysqlnd-qc.cache-by-default" class="link">mysqlnd_qc.cache_by_default</a>
    </li>
    <li class="member">
     <span class="function"><a href="function.mysqlnd-qc-set-user-handlers.html" class="function" rel="rdfs-seeAlso">mysqlnd_qc_set_user_handlers()</a> - D&eacute;finit les fonctions de rappel pour un gestionnaire de stockage proc&eacute;dural d&eacute;fini par l'utilisateur</span>
    </li>
   </ul>
  </p>
 </div>

 
</div></div></div></body></html>