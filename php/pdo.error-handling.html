<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Les erreurs et leur gestion</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="pdo.prepared-statements.html">« Requ&ecirc;tes pr&eacute;par&eacute;es et proc&eacute;dures stock&eacute;es</a></li>
      <li style="float: right;"><a href="pdo.lobs.html">Les gros objets (LOB) »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.pdo.html">PDO</a></li>
    <li>Les erreurs et leur gestion</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="pdo.error-handling" class="chapter">
 <h1>Les erreurs et leur gestion</h1>

 <p class="para">
  PDO vous offre 3 façons différentes de gérer les erreurs afin de mieux
  s&#039;adapter à votre application.
 </p>
 <ul class="itemizedlist">
  <li class="listitem">
   <p class="para">
    <strong><code>PDO::ERRMODE_SILENT</code></strong>
   </p>
   <p class="para">
    C&#039;est le mode par défaut. PDO définit simplement le code d&#039;erreur à inspecter
    grâce aux méthodes <span class="function"><a href="pdo.errorcode.html" class="function">PDO::errorCode()</a></span> et
    <span class="function"><a href="pdo.errorinfo.html" class="function">PDO::errorInfo()</a></span> sur les objets représentant
    les requêtes, mais aussi ceux représentant les bases de données ; si l&#039;erreur
    résulte d&#039;un appel à l&#039;objet représentant la requête, vous pouvez appeler
    la méthode <span class="function"><a href="pdostatement.errorcode.html" class="function">PDOStatement::errorCode()</a></span> ou la méthode
    <span class="function"><a href="pdostatement.errorinfo.html" class="function">PDOStatement::errorInfo()</a></span> sur l&#039;objet.
    Si l&#039;erreur résulte d&#039;un appel sur l&#039;objet représentant une base de données,
    vous pouvez également appeler ces deux mêmes méthodes sur l&#039;objet.
   </p>
  </li>
  <li class="listitem">
   <p class="para">
    <strong><code>PDO::ERRMODE_WARNING</code></strong>
   </p>
   <p class="para">
    En plus de définir le code d&#039;erreur, PDO émettra un message E_WARNING
    traditionnel. Cette configuration est utile lors des tests et du débogage,
    si vous voulez voir le problème sans interrompre l&#039;application.
   </p>
  </li>
  <li class="listitem">
   <p class="para">
    <strong><code>PDO::ERRMODE_EXCEPTION</code></strong>
   </p>
   <p class="para">
    En plus de définir le code d&#039;erreur, PDO lancera une exception
    <a href="class.pdoexception.html" class="classname">PDOException</a> et y définit les propriétés
    afin de représenter le code d&#039;erreur et les informations complémentaires.
    Cette configuration est également utile lors du débogage, car elle
    va « contourner » le point critique de votre code, vous montrer
    rapidement le problème rencontré (souvenez-vous : les transactions
    sont automatiquement annulées si l&#039;exception fait que votre script
    se termine).
   </p>
   <p class="para">
    Le mode &quot;exception&quot; est également très utile car ainsi, vous pouvez
    structurer votre gestionnaire d&#039;erreur plus clairement qu&#039;avec
    les alertes traditionnelles PHP et, ce, avec moins de code que
    lorsque vous exécutez votre code en mode silence, et que vous
    vérifiez systématiquement les valeurs retournées après chaque appel
    à la base de données.
   </p>
   <p class="para">
    Voir le chapitre sur les <a href="language.exceptions.html" class="link">exceptions</a>
    pour plus d&#039;informations sur les exceptions en PHP.
   </p>
  </li>
 </ul>
 <p class="para">
  PDO utilise les codes erreurs SQL-92 SQLSTATE ; chaque pilote PDO est
  responsable de lier ses codes natifs aux codes SQLSTATE appropriés.
  La méthode <span class="function"><a href="pdo.errorcode.html" class="function">PDO::errorCode()</a></span> retourne un code
  SQLSTATE unique. Si vous avez besoin d&#039;informations spécifiques sur
  l&#039;erreur, PDO vous propose également la méthode <span class="function"><a href="pdo.errorinfo.html" class="function">PDO::errorInfo()</a></span>
  qui retourne un tableau contenant le code SQLSTATE, le code d&#039;erreur spécifique
  du pilote et la chaîne décrivant l&#039;erreur provenant du pilote.
 </p>
 
 <p class="para">
  <div class="example" id="odbc-statistics.example.basic"><p><strong>Exemple #1 Création d&#039;une instance PDO et
   définition du mode d&#039;erreur</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mysql:dbname=testdb;host=127.0.0.1'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'dbuser'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'dbpass'</span><span style="color: #007700">;<br /><br />try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dbh&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">);<br />}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Échec&nbsp;lors&nbsp;de&nbsp;la&nbsp;connexion&nbsp;:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <p class="para">
   <span class="function"><a href="pdo.construct.html" class="function">PDO::__construct()</a></span> va toujours lancer une exception
   <a href="class.pdoexception.html" class="classname">PDOException</a> si la connexion échoue suivant la configuration
   de <strong><code>PDO::ATTR_ERRMODE</code></strong>. Les exceptions non attrappées deviennent
   des erreurs fatales.
  </p>
 </p></blockquote>
 <p class="para">
  <div class="example" id="odbc-tableprivileges.example.basic">
   <p><strong>Exemple #2 Crée une instance PDO et définit le mode d&#039;erreur depuis le constructeur</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mysql:dbname=test;host=127.0.0.1'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'googleguy'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'googleguy'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;&nbsp;&nbsp;L'utilisation&nbsp;des&nbsp;blocs&nbsp;try/catch&nbsp;autour&nbsp;du&nbsp;constructeur&nbsp;est&nbsp;toujours&nbsp;valide<br />&nbsp;&nbsp;&nbsp;&nbsp;même&nbsp;si&nbsp;nous&nbsp;définissons&nbsp;le&nbsp;ERRMODE&nbsp;à&nbsp;WARNING&nbsp;sachant&nbsp;que&nbsp;PDO::__construct<br />&nbsp;&nbsp;&nbsp;&nbsp;va&nbsp;toujours&nbsp;lancer&nbsp;une&nbsp;exception&nbsp;PDOException&nbsp;si&nbsp;la&nbsp;connexion&nbsp;échoue.<br />*/<br /></span><span style="color: #007700">try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dbh&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_WARNING</span><span style="color: #007700">));<br />}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Échec&nbsp;de&nbsp;la&nbsp;connexion&nbsp;:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Ceci&nbsp;fera&nbsp;que&nbsp;PDO&nbsp;lancera&nbsp;une&nbsp;erreur&nbsp;de&nbsp;niveau&nbsp;E_WARNING&nbsp;au&nbsp;lieu&nbsp;d'une&nbsp;exception&nbsp;(lorsque&nbsp;la&nbsp;table&nbsp;n'existe&nbsp;pas)<br /></span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;wrongcolumn&nbsp;FROM&nbsp;wrongtable"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

    <div class="example-contents"><p>L&#039;exemple ci-dessus va afficher :</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Warning: PDO::query(): SQLSTATE[42S02]: Base table or view not found: 1146 Table &#039;test.wrongtable&#039; doesn&#039;t exist in
/tmp/pdo_test.php on line 18
</pre></div>
    </div>
  </div>
 </p>
</div>
</div></div></body></html>