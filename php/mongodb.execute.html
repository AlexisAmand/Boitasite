<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Ex&eacute;cute le code JavaScript sur la base de donn&eacute;es [Obsol&egrave;te]</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mongodb.dropcollection.html">« MongoDB::dropCollection</a></li>
      <li style="float: right;"><a href="mongodb.forceerror.html">MongoDB::forceError »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.mongodb.html">MongoDB</a></li>
    <li>Ex&eacute;cute le code JavaScript sur la base de donn&eacute;es [Obsol&egrave;te]</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mongodb.execute" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">MongoDB::execute</h1>
  <p class="verinfo">(PECL mongo &gt;=0.9.3)</p><p class="refpurpose"><span class="refname">MongoDB::execute</span> &mdash; <span class="dc-title">Exécute le code JavaScript sur la base de données [Obsolète]</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mongodb.execute-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>MongoDB::execute</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$code</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$args</code><span class="initializer"> = array()</span></span>
  ] ) : <span class="type">array</span></div>

  <div class="warning"><strong class="warning">Avertissement</strong>
   <p class="para">
    La commande <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&raquo;&nbsp;eval</a>,
    que cette méthode appelle, est obsolète en MongoDB 3.0 et supérieur.
   </p>
  </div>
  <p class="para">
   Le serveur de base de données Mongo exécute un moteur Javascript.
   Cette méthode vous permet d&#039;exécuter du Javascript arbitraire sur la base
   de données. Ceci peut être utile si vous voulez toucher un petit
   nombre de collections, ou pour traiter quelques résultats issus de la
   base de données afin de réduire la quantitié de données à envoyer au client.
  </p>
  <p class="para">
   L&#039;exécution de Javascript dans la base de données pose un verrou en
   écriture, signifiant que les autres opérations sont bloquées.
   Gardez-le bien à l&#039;esprit avant d&#039;exécuter un script conséquant.
  </p>
  <p class="para">
   Ceci est un wrapper pour la commande
   <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&raquo;&nbsp;eval</a>
   de base de données. Cette méthode est équivalente à :
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$code</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$args</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">command</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'eval'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'args'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$args</span><span style="color: #007700">));<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </p>
  <p class="para">
   MongoDB implique une instruction de retour si vous avez une requête
   unique sur une seule ligne. Ceci peut causer des comportements
   non-intuitifs. Par exemple, l&#039;exemple suivant retournera &quot;foo&quot; :
  </p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">'"foo";'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <p class="para">
   Cependant, ceci retournera <strong><code>NULL</code></strong>:
  </p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">'"bar";&nbsp;"foo";'</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;plus&nbsp;d'une&nbsp;requête<br /><br /></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">'db.foo.count(<br />);'</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;plus&nbsp;d'une&nbsp;ligne<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <p class="para">
   Afin d&#039;éviter tout comportement non-désiré, il convient de ne pas
   laisser MongoDB choisir ce qu&#039;il doit retourner, mais explicitement
   définir une valeur de retour. Dans l&#039;exemple ci-dessus, nous pouvons
    le modifier comme ceci :
  </p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">'"bar";&nbsp;return&nbsp;"foo";'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">'return&nbsp;db.foo.count(<br />);'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <p class="para">
   Maintenant, la première requête retournera &quot;foo&quot;, et la seconde
   retournera un comptage de la collection &quot;foo&quot;.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mongodb.execute-parameters">
  <h3 class="title">Liste de paramètres</h3>
  <p class="para">
   <dl>

    
     <dt>

      <code class="parameter">code</code>
     </dt>

     <dd>

      <p class="para">
       un objet <a href="class.mongocode.html" class="classname">MongoCode</a> ou une chaîne
       a exécuter.
      </p>
     </dd>

       
    
     <dt>

      <code class="parameter">args</code>
     </dt>

     <dd>

      <p class="para">
       Les arguments à passer à la requête <code class="literal">code</code>.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mongodb.execute-returnvalues">
  <h3 class="title">Valeurs de retour</h3>
  <p class="para">
   Retourne le résultat de l&#039;évaluation.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mongodb.execute-examples">
  <h3 class="title">Exemples</h3>
  <div class="example" id="example-1519">
   <p><strong>Exemple #1 Exemple avec <span class="function"><strong>MongoDB::execute()</strong></span></strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">"function()&nbsp;{&nbsp;return&nbsp;'Bonjour&nbsp;le&nbsp;monde&nbsp;!';&nbsp;}"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$response</span><span style="color: #007700">[</span><span style="color: #DD0000">'retval'</span><span style="color: #007700">];<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>L&#039;exemple ci-dessus va afficher quelque chose de similaire à :</p></div>
   <div class="example-contents screen"><br />
Bonjour le monde !<br />
   </div>
  </div>
  <div class="example" id="example-1520">
   <p><strong>Exemple #2 Exemple avec <span class="function"><strong>MongoDB::execute()</strong></span></strong></p>
   <div class="example-contents"><p>
    Le tableau optionnel de paramètres sera passé à la fonction Javascript.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">"function(greeting,&nbsp;name)&nbsp;{&nbsp;return&nbsp;greeting+',&nbsp;'+name+'!';&nbsp;}"</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">"Au&nbsp;revoir"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"Joe"</span><span style="color: #007700">));<br />echo&nbsp;</span><span style="color: #0000BB">$response</span><span style="color: #007700">[</span><span style="color: #DD0000">'retval'</span><span style="color: #007700">];<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>L&#039;exemple ci-dessus va afficher quelque chose de similaire à :</p></div>
   <div class="example-contents screen"><br />
Au revoir, Joe!<br />
   </div>
  </div>
  <div class="example" id="example-1521">
   <p><strong>Exemple #3 Exemple de porté</strong></p>
   <div class="example-contents"><p>
    Si un objet <a href="class.mongocode.html" class="classname">MongoCode</a> est utilisé à la place d&#039;une chaîne
    comme premier paramètre, un scope peut être passé dans lequel le Javascript
    sera exécuté.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$func&nbsp;</span><span style="color: #007700">=<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"function(greeting,&nbsp;name)&nbsp;{&nbsp;"</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"return&nbsp;greeting+',&nbsp;'+name+',&nbsp;dit&nbsp;'+greeter;"</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"}"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$scope&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">"greeter"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"Fred"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$code&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MongoCode</span><span style="color: #007700">(</span><span style="color: #0000BB">$func</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$scope</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$code</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">"Au&nbsp;revoir"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"Joe"</span><span style="color: #007700">));<br />echo&nbsp;</span><span style="color: #0000BB">$response</span><span style="color: #007700">[</span><span style="color: #DD0000">'retval'</span><span style="color: #007700">];<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>L&#039;exemple ci-dessus va afficher quelque chose de similaire à :</p></div>
   <div class="example-contents screen"><br />
Au revoir, Joe, dit Fred<br />
   </div>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-mongodb.execute-seealso">
  <h3 class="title">Voir aussi</h3>
  <ul class="simplelist">
   <li class="member">La documentation MongoDB sur la <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&raquo;&nbsp;commande eval</a></li>
  </ul>
 </div>


 <div class="refsect1 changelog" id="refsect1-mongodb.execute-changelog">
  <h3 class="title">Historique</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>1.7.0</td>
       <td>
        Cette méthode est devenue obsolète, sachant qu&#039;un résultat d&#039;une
        commande <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&raquo;&nbsp;eval</a>
        sous-jacente est devenu obsolète en MongoDB 3.0+.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 
</div></div></div></body></html>