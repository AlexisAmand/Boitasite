<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>R&eacute;f&eacute;rence une fonction agr&eacute;gative d&eacute;finie par l'utilisateur pour une utilisation dans les requ&ecirc;tes SQL</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ref.pdo-sqlite.connection.html">« PDO_SQLITE DSN</a></li>
      <li style="float: right;"><a href="pdo.sqlitecreatecollation.html">PDO::sqliteCreateCollation »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.pdo-sqlite.html">SQLite (PDO)</a></li>
    <li>R&eacute;f&eacute;rence une fonction agr&eacute;gative d&eacute;finie par l'utilisateur pour une utilisation dans les requ&ecirc;tes SQL</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="pdo.sqlitecreateaggregate" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">PDO::sqliteCreateAggregate</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.0, PHP 7, PECL pdo_sqlite &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">PDO::sqliteCreateAggregate</span> &mdash; <span class="dc-title">
   Référence une fonction agrégative définie par l&#039;utilisateur pour une utilisation dans les requêtes SQL
  </span></p>

 </div>

 <div class="refsect1 description" id="refsect1-pdo.sqlitecreateaggregate-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>PDO::sqliteCreateAggregate</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$function_name</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$step_func</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$finalize_func</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$num_args</code></span>
  ] ) : <span class="type">bool</span></div>

  <div class="warning"><strong class="warning">Avertissement</strong><p class="simpara">
 Cette fonction est <em class="emphasis">EXPERIMENTALE</em>. Le comportement de cette fonction, son nom, et toute la
 documentation autour de cette fonction peut changer sans préavis dans une prochaine version de PHP.
 Cette fonction doit être utilisée à vos risques et périls.
</p></div>
  <p class="para">
   Cette méthode est similaire à <a href="pdo.sqlitecreatefunction.html" class="xref">PDO::sqliteCreateFunction</a> à l&#039;exception qu&#039;elle référence les fonctions qui peuvent être utilisées pour calculer un 
   résultat agrégé à travers toutes les lignes d&#039;une requête.
  </p>
  <p class="para">
   La différence entre cette méthode  et <a href="pdo.sqlitecreatefunction.html" class="xref">PDO::sqliteCreateFunction</a> est que deux fonctions sont
   requises pour gérer les agrégation.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-pdo.sqlitecreateaggregate-parameters">
  <h3 class="title">Liste de paramètres</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">function_name</code></dt>

     <dd>

      <p class="para">
       Le nom de la fonction utilisée dans les requêtes SQL.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">step_func</code></dt>

     <dd>

      <p class="para">
       Fonction de rappel appelée pour chaque ligne dans le jeu de résultats. Votre
       fonction PHP devrait accumuler le résultat et stocker son contexte d&#039;agrégation.
      </p>
      <p class="para">
       Cette fonction doit être définie comme :
       <div class="methodsynopsis dc-description">
        <span class="methodname"><span class="replaceable">step</span></span>
         ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$context</code></span>
        , <span class="methodparam"><span class="type">int</span> <code class="parameter">$rownumber</code></span>
        , <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$value1</code></span>
        [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$...</code></span>
       ] ) : <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span></div>

       <dl>

        
         <dt>
<code class="parameter">context</code></dt>

         <dd>

          <p class="para">
           <strong><code>NULL</code></strong> pour la première ligne ; sur les lignes suivantes ceci aura la valeur
           qui a été précedement retourné par la fonction step ; vous devriez utiliser
           ceci pour maintenir l&#039;état d&#039;aggregation.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">rownumber</code></dt>

         <dd>

          <p class="para">
           Le numéro de ligne courante.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">value1</code></dt>

         <dd>

          <p class="para">
           Le premier argument à passer à l&#039;agrégateur.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">...</code></dt>

         <dd>

          <p class="para">
           Arguments supplémentaires à passer à l&#039;agrégateur.
          </p>
         </dd>

        
       </dl>

       La valeur retournée de cette fonction sera utilisée comme argument
       <code class="parameter">context</code> lors du prochain appel d&#039;une fonction
       d&#039;étape ou finale.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">finalize_func</code></dt>

     <dd>

      <p class="para">
       Fonction de rappel pour agréger les &quot;étapes&quot; de données de chaque ligne.
       Une fois que toutes les lignes ont été traitées, la fonction sera appelée,
       prendra les données du contexte d&#039;agrégation et retournera le résultat.
       La fonction de rappel doit retourner un type compris 
       par SQLite (c&#039;est-à-dire <a href="language.types.intro.html" class="link">un type scalaire</a>).
      </p>
      <p class="para">
       Cette fonction doit être définie comme :
       <div class="methodsynopsis dc-description">
        <span class="methodname"><span class="replaceable">fini</span></span>
         ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$context</code></span>
        , <span class="methodparam"><span class="type">int</span> <code class="parameter">$rowcount</code></span>
        ) : <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span></div>

       <dl>

        
         <dt>
<code class="parameter">context</code></dt>

         <dd>

          <p class="para">
           Contient la valeur de retour du tout dernier appel à la fonction step.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">rowcount</code></dt>

         <dd>

          <p class="para">
           Contient le nombre de lignes sur lesquelles l&#039;agrégat a été effectué.
          </p>
         </dd>

        
       </dl>

       La valeur de retour de cette fonction sera utilisée comme valeur de retour pour
       l&#039;agrégation.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">num_args</code></dt>

     <dd>

      <p class="para">
       Conseil à l&#039;analyseur SQLite si la fonction de rappel accepte un nombre
       prédéterminé d&#039;arguments.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-pdo.sqlitecreateaggregate-returnvalues">
  <h3 class="title">Valeurs de retour</h3>
  <p class="para">
   Cette fonction retourne <strong><code>TRUE</code></strong> en cas de succès ou <strong><code>FALSE</code></strong> si une erreur survient.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-pdo.sqlitecreateaggregate-examples">
  <h3 class="title">Exemples</h3>
  <p class="para">
   <div class="example" id="example-1079">
    <p><strong>Exemple #1 Exemple d&#039;agrégation avec une fonction max_length</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$data&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'one'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'two'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'three'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'four'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'five'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'six'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'seven'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'eight'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'nine'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'ten'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;);<br /></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'sqlite::memory:'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">exec</span><span style="color: #007700">(</span><span style="color: #DD0000">"CREATE&nbsp;TABLE&nbsp;strings(a)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$insert&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'INSERT&nbsp;INTO&nbsp;strings&nbsp;VALUES&nbsp;(?)'</span><span style="color: #007700">);<br />foreach&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$insert</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #0000BB">$str</span><span style="color: #007700">));<br />}<br /></span><span style="color: #0000BB">$insert&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /><br />function&nbsp;</span><span style="color: #0000BB">max_len_step</span><span style="color: #007700">(</span><span style="color: #0000BB">$context</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$rownumber</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$string</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$string</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">$context</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$context&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$string</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$context</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">max_len_finalize</span><span style="color: #007700">(</span><span style="color: #0000BB">$context</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$rownumber</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$context&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">$context</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sqliteCreateAggregate</span><span style="color: #007700">(</span><span style="color: #DD0000">'max_len'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'max_len_step'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'max_len_finalize'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;max_len(a)&nbsp;from&nbsp;strings'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">());<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   Dans cet exemple, on crée une fonction agrégative qui va calculer la
   longueur de la plus grande chaîne de caractères dans une des colonnes de la
   table. Pour chaque ligne, la fonction <code class="literal">max_len_step</code> est
   appelée et le paramètre <code class="literal">$context</code> est passé. Le
   paramètre de contexte est comme n&#039;importe quelle autre variable PHP et
   doit être fixé pour contenir un tableau ou même, un objet. Dans cet exemple,
   nous l&#039;utilisons pour contenir la taille maximale que nous avons vu jusqu&#039;à
   présent ; si le paramètre <code class="literal">$string</code> a une grandeur plus
   importante que celle courante, on met à jour le contexte pour contenir cette
   nouvelle taille maximale.
  </p>
  <p class="para">
   Une fois que toutes les lignes ont été traitées, SQLite appelle la fonction
   <code class="literal">max_len_finalize</code> pour déterminer le résultat agrégatif.
   Ici, nous pourrions effectuer des calculs basés sur les données trouvées
   dans <code class="literal">$context</code>. Dans notre exemple simple, nous avons
   calculé le résultat comme si la requête progressait, alors que nous avons
   simplement besoin de retourner la valeur de contexte.
  </p>
  <div class="tip"><strong class="tip">Astuce</strong>
   <p class="para">
    Il n&#039;est PAS recommandé d&#039;enregistrer une copie des valeurs dans le contexte
    pour finalement les traiter. Dans ce cas, SQLite utiliserait beaucoup trop
    de mémoire pour traiter la requête - imaginez la quantité de mémoire nécessaire
    si un million de lignes étaient enregistrées en mémoire, sachant que chaque ligne
    contient une chaîne de caractères (32 octets par chaîne).
   </p>
  </div>
  <div class="tip"><strong class="tip">Astuce</strong>
   <p class="para">
    Vous pouvez utiliser <a href="pdo.sqlitecreatefunction.html" class="xref">PDO::sqliteCreateFunction</a> et
    <a href="pdo.sqlitecreateaggregate.html" class="xref">PDO::sqliteCreateAggregate</a> pour surcharger les
    fonctions natives de SQLite.
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Cette méthode n&#039;est pas disponible avec les pilotes de SQLite2.
    Utilisez l&#039;ancien style de l&#039;API sqlite à la place.
   </p>
  </p></blockquote>

 </div>



 <div class="refsect1 seealso" id="refsect1-pdo.sqlitecreateaggregate-seealso">
  <h3 class="title">Voir aussi</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="pdo.sqlitecreatefunction.html" class="xref">PDO::sqliteCreateFunction</a></li>
    <li class="member"><span class="function"><a href="function.sqlite-create-function.html" class="function" rel="rdfs-seeAlso">sqlite_create_function()</a> - Enregistre une fonction utilisateur &quot;classique&quot; UDF pour SQLite</span></li>
    <li class="member"><span class="function"><a href="function.sqlite-create-aggregate.html" class="function" rel="rdfs-seeAlso">sqlite_create_aggregate()</a> - Enregistre une UDF agr&eacute;geante pour les requ&ecirc;tes SQLite</span></li>
   </ul>
  </p>
 </div>


</div></div></div></body></html>