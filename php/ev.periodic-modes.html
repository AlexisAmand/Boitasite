<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Modes d'op&eacute;ration p&eacute;riodique d'un watcher</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ev.watcher-callbacks.html">« Les fonctions de rappel d'un Watcher</a></li>
      <li style="float: right;"><a href="class.ev.html">Ev »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.ev.html">Ev</a></li>
    <li>Modes d'op&eacute;ration p&eacute;riodique d'un watcher</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ev.periodic-modes" class="chapter">
 <h1>Modes d&#039;opération périodique d&#039;un watcher</h1>

 <p class="para">
  Le watcher <a href="class.evperiodic.html" class="classname">EvPeriodic</a> fonctionne en différents
  modes suivant les paramètres <code class="parameter">offset</code>,
  <code class="parameter">interval</code> et <code class="parameter">reschedule_cb</code>.
 </p>
 <ol type="1">
  <li class="listitem">
   <p class="para">
    Le mode <em class="emphasis">Minuterie absolue</em>. Dans ce mode,
    <code class="parameter">interval</code> = <strong><code>0</code></strong>,
    <code class="parameter">reschedule_cb</code> = <strong><code>NULL</code></strong>.
    L&#039;appel se fera à l&#039;heure d&#039;horloge <code class="parameter">offset</code>
    et ne sera pas répété. Il ne sera pas ajusté lorsqu&#039;un bon dans le temps
    surviendra, aussi, s&#039;il doit être exécuté à
    <em class="emphasis">January 1st 2014</em>, alors il le sera lorsque l&#039;heure
    système sera atteinte, ou dépassée.
   </p>
  </li>
  <li class="listitem">
   <p class="para">
    Le mode <em class="emphasis">Minuterie avec répétition par intervalle</em>.
    Dans ce mode, <code class="parameter">interval</code> &gt; <strong><code>0</code></strong>,
    <code class="parameter">reschedule_cb</code> = <strong><code>NULL</code></strong> ; le watcher sera automatiquement
    programmé pour se terminer à la prochaine durée
    <code class="parameter">offset</code> + <strong><code>N</code></strong> * <code class="parameter">interval</code>
    (pour un entier <strong><code>N</code></strong>) puis, se répète, indépendamment des sauts
    dans le temps.
   </p>
   <p class="para">
    Il peut être utilisé pour créer des minuteries qui ne dérivent pas en respectant
    l&#039;horloge système :
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$hourly&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">EvPeriodic</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3600</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,&nbsp;function&nbsp;()&nbsp;{<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"une&nbsp;fois&nbsp;par&nbsp;heure\n"</span><span style="color: #007700">;<br />});<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    Cela ne signifie pas qu&#039;il y aura toujours <strong><code>3600</code></strong> secondes
    entre chaque appel, mais seulement que la fonction de rappel sera appelée
    lorsque l&#039;horloge système affichera une heure pleine (<em class="emphasis">UTC</em>).
   </p>
   <p class="para">
    La classe <a href="class.evperiodic.html" class="classname">EvPeriodic</a> va tenter d&#039;exécuter la fonction
    de rappel dans ce mode à la prochaine heure possible où
    <var class="varname">time</var> = <code class="parameter">offset</code> (<code class="literal">mod</code>
    <code class="parameter">interval</code>), indépendamment des sauts dans le temps.
   </p>
  </li>
  <li class="listitem">
   <p class="para">
    Le mode <em class="emphasis">reprogrammation manuelle</em>. Dans ce mode,
    <code class="parameter">reschedule_cb</code> est un <span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span>.
   </p>
   <p class="para">
    <code class="parameter">interval</code> et <code class="parameter">offset</code>
    seront tous les deux ignorés. A la place, chaque fois que le watcher périodique
    est prévue, la fonction de rappel de reprogrammation (<code class="parameter">reschedule_cb</code>) 
    sera appelée avec le watcher d&#039;abord, et le temps courant comme second argument.
   </p>
   <p class="para">
    Cette fonction de rappel <em class="emphasis">ne doit pas</em> stopper ou détruire
    ce watcher périodique, ni un autre, et <em class="emphasis">ne doit pas</em>
    appeler de fonctions ou de méthodes de boucle d&#039;événements. Pour le stopper,
    retournez <strong><code>1e30</code></strong> et stoppez le après. Un watcher
    <a href="class.evprepare.html" class="classname">EvPrepare</a> peut être utilisé pour réaliser cette tâche.
   </p>
   <p class="para">
    Il doit retourner la prochaine heure d&#039;appel, en se basant sur la valeur
    du temps passé (la plus petite valeur de temps doit être supérieure
    ou égale au second argument). Il sera appelée, habituellement, juste après
    que la fonction de rappel ne soit lancée, mais possiblement à d&#039;autres moments.
   </p>
   <div class="example" id="example-3914">
    <p><strong>Exemple #1 Using reschedule callback</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Chaque&nbsp;10.5&nbsp;secondes<br /><br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">reschedule_cb&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$watcher</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$now</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$now&nbsp;</span><span style="color: #007700">+&nbsp;(</span><span style="color: #0000BB">10.5</span><span style="color: #007700">.&nbsp;-&nbsp;</span><span style="color: #0000BB">fmod</span><span style="color: #007700">(</span><span style="color: #0000BB">$now</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10.5</span><span style="color: #007700">));<br />}<br /><br /></span><span style="color: #0000BB">$w&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">EvPeriodic</span><span style="color: #007700">(</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"reschedule_cb"</span><span style="color: #007700">,&nbsp;function&nbsp;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$revents</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />});<br /><br /></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </li>
 </ol>
</div>
</div></div></body></html>