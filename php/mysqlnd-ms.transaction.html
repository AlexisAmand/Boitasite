<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Gestion des transactions locales</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqlnd-ms.pooling.html">« Groupe de connexions et bascule entre les connexions</a></li>
      <li style="float: right;"><a href="mysqlnd-ms.errorhandling.html">Gestion des erreurs »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqlnd-ms.concepts.html">Concepts</a></li>
    <li>Gestion des transactions locales</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqlnd-ms.transaction" class="section">
  <h2 class="title">Gestion des transactions locales</h2>
  <p class="para">
   La gestion des transactions est impactée en profondeur. Une transaction est une unité logique
   lancée par le serveur. Cette unité peut se composer d&#039;une ou plusieurs requêtes.
  </p>
  <p class="para">
   Par défaut, le plugin ne se soucie pas des transactions SQL. Il est donc possible qu&#039;il
   décide de basculer de connexions dans le cadre de la répartition de charge, et ceci peut
   arriver au milieu d&#039;une transaction. C&#039;est contre la nature même d&#039;une transaction SQL, le
   plugin n&#039;est donc, par défaut, pas au courant des transactions.
  </p>
  <p class="para">
   Toute type de balance de charge MySQL peut être touché entre le début et la fin
   d&#039;une transaction. Ce peut être de façon explicitie en monitorant les appels API
   ou en utilisant des astuces SQL. L&#039;API de monitorage nécessite PHP 5.4.0 ou supérieur.
   Le plugin, tout comme n&#039;importe quel répartiteur de charge MySQL, ne peut pas
   détecter les limites d&#039;une transaction en se basant sur le protocole client serveur
   de MySQL. Aussi, une transparence totale d&#039;une transaction avec un répartiteur
   de charge n&#039;est pas possible. L&#039;option la moins intrusive est l&#039;API de monitorage,
   qui nécessite très peu de modifications de l&#039;application.
  </p>
  <p class="para">
   Vous trouverez des exemples d&#039;utilisation d&#039;astuces SQL ou de l&#039;API de
   monitorage dans la <a href="mysqlnd-ms.quickstart.html" class="link">section des exemples</a>.
   Les détails de l&#039;API de monitorage, qui rend les transactions au niveau du plugin
   sûres, sont décrits ci-dessous.
  </p>
  <p class="para">
   Depuis PHP 5.4.0, la bibliothèque <a href="book.mysqlnd.html" class="link">mysqlnd</a>
   autorise ce plugin à surcharger l&#039;appel API C <code class="literal">set_autocommit()</code>,
   afin de détecter le statut du mode <code class="literal">autocommit</code>.
  </p>
  <p class="para">
   Les extensions PHP pour MySQL effectuent une requête (comme <code class="literal">SET AUTOCOMMIT=0|1</code>),
   ou utilisent l&#039;appel mysqlnd <code class="literal">set_autocommit()</code> pour contrôler le statut de
   l&#039;<code class="literal">autocommit</code>. Si une extension utilise
   <code class="literal">set_autocommit()</code>, le plugin sera au courant des transactions, ce
   n&#039;est pas le cas si du SQL est utilisé.
   L&#039;appel <code class="literal">set_autocommit()</code> est utilisé par
   <span class="function"><a href="mysqli.autocommit.html" class="function">mysqli_autocommit()</a></span> et
   <code class="literal">PDO::setAttribute(PDO::ATTR_AUTOCOMMIT)</code>.
  </p>
  <p class="para">
   L&#039;option de configuration du plugin <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.trx-stickiness" class="link">trx_stickiness=master</a>
   peut être utilisée pour rendre le plugin sensible aux transactions.
   Grâce à ça, le plugin arrête la répartition de charge si l&#039;autocommit est désactivé,
   et la réactive dans le cas contraire.
  </p>
  <p class="para">
   Une application qui ne veut pas utiliser les astuces SQL pour les transactions
   mais souhaite utiliser l&#039;API de monitorage pour éviter les modifications applicatifs
   doit s&#039;assurer que la configuration autocommit est bien modifiée que via les appels
   API listés.
  </p>
  <p class="para">
   La détection des limites d&#039;une transaction en se basant que l&#039;API a été
   améliorée avec PHP 5.5.0 et PECL/mysqlnd_ms 1.5.0 pour couvrir non seulement
   les appels à <span class="function"><a href="mysqli.autocommit.html" class="function">mysqli_autocommit()</a></span> mais aussi à
   <span class="function"><strong>mysqli_begin()</strong></span>, <span class="function"><a href="mysqli.commit.html" class="function">mysqli_commit()</a></span> et
   <span class="function"><a href="mysqli.rollback.html" class="function">mysqli_rollback()</a></span>.
  </p>
 </div></div></div></body></html>