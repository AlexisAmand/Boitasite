<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Clusters support&eacute;s</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqlnd-ms.concept_cache.html">« Int&eacute;gration du cache</a></li>
      <li style="float: right;"><a href="mysqlnd-ms.concept_xa_trx.html">XA/Distributed transactions »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="mysqlnd-ms.concepts.html">Concepts</a></li>
    <li>Clusters support&eacute;s</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqlnd-ms.supportedclusters" class="section">
  <h2 class="title">Clusters supportés</h2>
  <p class="para">
   Toute application utilisant n&#039;importe quel cluster MySQL est soumises aux mêmes tâches:
   <ul class="itemizedlist">
    
    <li class="listitem">
     <span class="simpara">
      Identifier les noeuds capables d&#039;exécuter une requête avec un niveau de service requis.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Equilibrer et distribuer la requête parmi les candidats.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Gestion automatique des pannes parmi les candidats, si nécessaire.
     </span>
    </li>
   </ul>
  </p>
  <p class="para">
   Le plugin est optimisé pour gérer ces tâches dans un contexte de réplication MySQL
   asynchrone classique, à savoir un seul maitre et plusieurs esclaves (copie primaire).
   Dans ce cas, toutes les tâches listées plus haut doivent être gérées coté client.
  </p>
  <p class="para">
   D&#039;autres types de clusters MySQL ont moins d&#039;implication coté client.
   Par exemple, si tous les noeuds du cluster peuvent répondre aux lectures et aux écritures,
   aucune séparation ne sera nécessaire (plusieurs maîtres, mise à jour total).
   Si tous les noeuds sont synchrones, ils sont tous éligibles avec le même poids, ce qui
   simplifie la tâche de selection. Dans de tels cas, le plugin doit être reconfiguré pour
   désactiver certaines logiques, comme la séparation des lectures/écritures.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>But de la documentation</strong><br />
   <p class="para">
    La documentation décrit l&#039;utilisation du plugin dans un cas classique de réplication
    asynchrone (copie primaire). C&#039;est le cas de base, qui a inspiré l&#039;écriture du plugin.
    D&#039;autres types de clusters sont décrits brièvement ci-dessous, nous continuons à
    travailler dessus actuellement.
   </p>
  </p></blockquote>
  <p class="para">
   <em class="emphasis">Copie primaire (Réplication MySQL)</em>
  </p>
  <p class="para">
   C&#039;est le but primaire de ce plugin. Suivez les astuces fournies dans les
   descriptions de chacune des fonctionalités.
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      Configure un maître et un ou plusieurs esclaves.
      <a href="mysqlnd-ms.plugin-ini-json.html#mysqlnd-ms.plugin-ini-json.server-list-syntax" class="link">Les détails de la
       configuration du serveur</a> sont fournis dans la section sur l&#039;installation.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Utilisez la politique de balance de charge aléatoire avec le flag
      <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.filter-random" class="link">sticky</a>.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Si vous ne prévoyez pas d&#039;utiliser les appels API
      <a href="mysqlnd-ms.quickstart.qos-consistency.html" class="link">du niveau de service</a>,
      ajoutez le flag
      <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.master-on-write" class="link">d&#039;écriture sur le maître</a>.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Soyez prudent sur les propriétés du failover automatique avant d&#039;ajouter
      la directive <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.failover" class="link">failover</a>.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Vous devriez considérer l&#039;utilisation du flag
      <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.trx-stickiness" class="link">trx_stickiness</a>
      pour exécuter les transactions uniquement sur le primaire. Veuillez lire
      attentivement son mode de fonctionnement avant de l&#039;utiliser.
     </span>
    </li>
   </ul>
  </p>
  <p class="para">
   <div class="example" id="example-2206">
    <p><strong>Exemple #1 Activation du plugin (php.ini)</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_ms.enable=1
mysqlnd_ms.config_file=/path/to/mysqlnd_ms_plugin.ini</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-2207">
    <p><strong>Exemple #2 Configuration simple du plugin (mysqlnd_ms_plugin.ini) pour une réplication MySQL</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">{
  &quot;myapp&quot;: {
    &quot;master&quot;: {
      &quot;master_1&quot;: {
        &quot;host&quot;: &quot;localhost&quot;,
        &quot;socket&quot;: &quot;\/tmp\/mysql57.sock&quot;
      }
    },
    &quot;slave&quot;: {
      &quot;slave_0&quot;: {
        &quot;host&quot;: &quot;127.0.0.1&quot;,
        &quot;port&quot;: 3308
      },
      &quot;slave_1&quot;: {
        &quot;host&quot;: &quot;192.168.2.28&quot;,
        &quot;port&quot;: 3306
      }
    },
    &quot;filters&quot;: {
      &quot;random&quot;: {
        &quot;sticky&quot;: &quot;1&quot;
      }
    }
  }
}</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   <em class="emphasis">Copie primaire avec plusieurs primaires (MMM - MySQL Multi Master)</em>
  </p>
  <p class="para">
   La réplication MySQL vous permet de créer des topologies de cluster avec plusieurs maîtres (primaires).
   Les conflits d&#039;écriture ne sont pas gérées par le système de réplication. Aussi,
   les données doivent être partitionnées manuellement et les clients doivent être redirigés suivant
   les règles de partitionnement. La configuration recommandée est identique à la configuration
   de fragmentation ci-dessous.
  </p>
  <p class="para">
   <em class="emphasis">Fragmentation manuelle, combinée éventuellement avec une copie primaire et plusieurs
    primaires</em>
  </p>
  <p class="para">
   Utilisez les astuces SQL et le filtre de groupe du noeud pour les clusters qui utilisent
   le partitionnement des données, mais laissez au client la redirection de la requête. L&#039;exemple de configuration
   montre une configuration de plusieurs maîtres avec deux fragmentations.
  </p>
  <p class="para">
   <div class="example" id="example-2208">
    <p><strong>Exemple #3 Plusieurs primaires - plusieurs maîtres (php.ini)</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_ms.enable=1
mysqlnd_ms.config_file=/path/to/mysqlnd_ms_plugin.ini
mysqlnd_ms.multi_master=1</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-2209">
    <p><strong>Exemple #4 Copie primaire avec plusieurs primaires et le partitionnement</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">{
  &quot;myapp&quot;: {
    &quot;master&quot;: {
      &quot;master_1&quot;: {
        &quot;host&quot;: &quot;localhost&quot;,
        &quot;socket&quot;: &quot;\/tmp\/mysql57.sock&quot;
      }
      &quot;master_2&quot;: {
        &quot;host&quot;: &quot;192.168.2.27&quot;,
        &quot;socket&quot;: &quot;3306&quot;
      }
    },
    &quot;slave&quot;: {
      &quot;slave_1&quot;: {
        &quot;host&quot;: &quot;127.0.0.1&quot;,
        &quot;port&quot;: 3308
      },
      &quot;slave_2&quot;: {
        &quot;host&quot;: &quot;192.168.2.28&quot;,
        &quot;port&quot;: 3306
      }
    },
    &quot;filters&quot;: {
      &quot;node_groups&quot;: {
        &quot;Partition_A&quot; : {
          &quot;master&quot;: [&quot;master_1&quot;],
          &quot;slave&quot;: [&quot;slave_1&quot;]
        },
        &quot;Partition_B&quot; : {
          &quot;master&quot;: [&quot;master_2&quot;],
          &quot;slave&quot;: [&quot;slave_2&quot;]
        }
      },
      &quot;roundrobin&quot;: []
    }
  }
}</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   Le plugin peut également être utilisé avec une collection mouvante de
   morceaux indépendants. Pour un tel cluster, configurez les maîtres uniquement
   et désactivez la séparation des lectures/écritures. Les noeuds d&#039;un tel cluster
   sont appelés maîtres dans la configuration du plugin vu qu&#039;ils acceptent à la fois
   les lectures et les écritures pour leur partition.
  </p>
  <p class="para">
   <em class="emphasis">Using synchronous update everywhere clusters such as MySQL Cluster</em>
  </p>
  <p class="para">
   MySQL Cluster est une solution de cluster synchrone. Tous les noeuds acceptent des lectures et des
   écritures. D&#039;un point de vue du plugin, tous les noeuds devraient alors être considérés comme des
   maitres.
  </p>
  <p class="para">
   Utilisez les fonctionnalités d&#039;équilibre de charge et de reprise sur panne seulement.
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      Désactivez le support de <a href="mysqlnd-ms.rwsplit.html" class="link">la séparation des lectures et écritures</a>.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Ne configurez que les maitres.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Considerant la strategy &quot;random once&quot; (cas par défaut), seuls les maitres sont
      configurés et aucune astuce SQL n&#039;est requise, aucune bascule de connexion
      n&#039;arrivera durant la requête web. Ainsi, aucune directive particulière n&#039;est requise
      en ce qui concerne les transactions, le plugin selectionnera un maitre au début du script
      PHP et l&#039;utilisera jusqu&#039;à la fin.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Ne précisez pas la qualité de service. Tous les noeuds possèdent toutes les données.
      Ceci vous fournit la consistence maximale (consistence forte).
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      N&#039;activez pas l&#039;injection d&#039;identifiant de transaction coté client. Ceci ne sera d&#039;aucune
      aide.
     </span>
    </li>
   </ul>
  </p>
  <p class="para">
   Désactiver la répartition des lectures/écritures.
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      Mettez
      <a href="mysqlnd-ms.configuration.html" class="link"><code class="literal">mysqlnd_ms.disable_rw_split=1</code></a>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      N&#039;utilisez pas <a href="mysqlnd-ms.rwsplit.html" class="link">d&#039;astuces SQL</a> pour forcer l&#039;utilisation
      d&#039;un noeud.
     </span>
    </li>
   </ul>
  </p>
  <p class="para">
   Ne configurez que les maitres.
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      Mettez
      <a href="mysqlnd-ms.configuration.html" class="link"><code class="literal">mysqlnd_ms.multi_master=1</code>.</a>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">Ne configurez aucun esclave.</span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Mettez
      <code class="literal"><a href="mysqlnd-ms.plugin-ini-json.html" class="link">failover=loop_before_master</a></code>
      dans le fichier de configuration du plugin, pour éviter les messages d&#039;avertissement
      concernant une liste d&#039;esclave vide et pour permettre à la logique de boucle du
      failover de parcourir tous les maîtres configurés avant d&#039;émettre une erreur.
     </span>
     <span class="simpara">
      Notez les alertes fournies à propos du failover automatique dans les précédentes
      sections.
     </span>
    </li>
   </ul>
  </p>
  <p class="para">
   <div class="example" id="example-2210">
    <p><strong>Exemple #5 Plusieurs primaires - plusieurs maîtres (php.ini)</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_ms.enable=1
mysqlnd_ms.config_file=/path/to/mysqlnd_ms_plugin.ini
mysqlnd_ms.multi_master=1
mysqlnd_ms.disable_rw_split=1</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-2211">
    <p><strong>Exemple #6 Mise à jour synchrone dans n&#039;importe quel cluster</strong></p>
    <div class="example-contents">
<div class="inicode"><pre class="inicode">&quot;myapp&quot;: {
    &quot;master&quot;: {
      &quot;master_1&quot;: {
        &quot;host&quot;: &quot;localhost&quot;,
        &quot;socket&quot;: &quot;\/tmp\/mysql57.sock&quot;
      },
      &quot;master_2&quot;: {
        &quot;host&quot;: &quot;192.168.2.28&quot;,
        &quot;port&quot;: 3306
      }
    },
    &quot;slave&quot;: {
    },
    &quot;filters&quot;: {
      &quot;roundrobin&quot;: {
      }
    },
    &quot;failover&quot;: {
      &quot;strategy&quot;: &quot;loop_before_master&quot;,
      &quot;remember_failed&quot;: true
    }
  }
}</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   Si vous exécutez une mise à jour dans n&#039;importe quel cluster qui ne supporte
   pas le partitionnement afin d&#039;éviter les points chauds et les collisions,
   vous devriez considérer l&#039;utilisation du filtre sur les groupes de noeuds
   pour conserver les mises à jour sur les tables fréquemment utilisées sur
   un de ces noeuds. Ceci peut aider à réduire les collisions, et donc,
   améliorer les performances.
  </p>
 </div></div></div></body></html>